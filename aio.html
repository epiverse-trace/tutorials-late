<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Scenario modelling for outbreak analytics with R: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XZ471458FQ');
    </script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/epiverse-trace/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicons/epiverse-trace/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicons/epiverse-trace/favicon-16x16.png">
<link rel="manifest" href="favicons/epiverse-trace/site.webmanifest">
<link rel="mask-icon" href="favicons/epiverse-trace/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav epiverse-trace"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="epiverse-trace-logo" alt="epiverse-trace" src="assets/images/epiverse-trace-logo.svg"><span class="badge text-bg-danger" style="background-color: #FF4955; border-radius: 5px">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav epiverse-trace" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="epiverse-trace" src="assets/images/epiverse-trace-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Scenario modelling for outbreak analytics with R
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Scenario modelling for outbreak analytics with R
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="BF_measles.html">Introduction to Mathematical Modelling of Infectious Diseases</a></li>
<li><a class="dropdown-item" href="reference.html">Glossary of Terms: Epiverse-TRACE</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Scenario modelling for outbreak analytics with R
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress epiverse-trace">
    <div class="progress-bar epiverse-trace" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="contact-matrices.html">1. Contact matrices</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="simulating-transmission.html">2. Simulating transmission</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="model-choices.html">3. Choosing an appropriate model</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="modelling-interventions.html">4. Modelling interventions</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="compare-interventions.html">5. Comparing public health outcomes of interventions</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="vaccine-comparisons.html">6. Comparing vaccination strategies</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="disease-burden.html">7. Modelling disease burden</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="BF_measles.html">Introduction to Mathematical Modelling of Infectious Diseases</a></li>
<li><a href="reference.html">Glossary of Terms: Epiverse-TRACE</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-contact-matrices"><p>Content from <a href="contact-matrices.html">Contact matrices</a></p>
<hr>
<p>Last updated on 2025-05-06 |

        <a href="https://github.com/epiverse-trace/tutorials-late/edit/main/episodes/contact-matrices.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a contact matrix?</li>
<li>How are contact matrices estimated?</li>
<li>How are contact matrices used in epidemiological analysis?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use the R package <code>socialmixr</code> to estimate a contact
matrix</li>
<li>Understand the different types of analysis contact matrices can be
used for</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>Some groups of individuals have more contacts than others; the
average schoolchild has many more daily contact than the average elderly
person, for example. This heterogeneity of contact patterns between
different groups can affect disease transmission, because certain groups
are more likely to transmit to others within that group, as well as to
other groups. The rate at which individuals within and between groups
make contact with others can be summarised in a contact matrix. In this
tutorial we are going to learn how contact matrices can be used in
different analyses and how the <a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a> package can be
used to estimate contact matrices.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">socialmixr</span><span class="op">)</span></span></code></pre>
</div>

</section><section><h2 class="section-heading" id="the-contact-matrix">The contact matrix<a class="anchor" aria-label="anchor" href="#the-contact-matrix"></a>
</h2>
<hr class="half-width">
<p>The basic contact matrix represents the amount of contact or mixing
within and between different subgroups of a population. The subgroups
are often age categories but can also be:</p>
<ul>
<li>Geographic areas (e.g., different regions or countries)</li>
<li>Risk groups (e.g., high/low risk occupations)</li>
<li>Social settings (e.g., household, workplace, school)</li>
</ul>
<p>For example, a hypothetical contact matrix representing the average
number of contacts per day between children and adults could be:</p>
<p><span class="math display">\[
\begin{bmatrix}
2 &amp; 2\\
1 &amp; 3
\end{bmatrix}
\]</span> In this example, we would use this to represent that children
meet, on average, 2 other children and 2 adult per day (first row), and
adults meet, on average, 1 child and 3 other adults per day (second
row). We can use this kind of information to account for the role
heterogeneity in contact plays in infectious disease transmission.</p>
<div id="a-note-on-notation" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="a-note-on-notation" class="callout-inner">
<h3 class="callout-title">A Note on Notation</h3>
<div class="callout-content">
<p>For a contact matrix with rows <span class="math inline">\(i\)</span>
and columns <span class="math inline">\(j\)</span>:</p>
<ul>
<li>
<span class="math inline">\(C[i,j]\)</span> represents the average
number of contacts that individuals in group <span class="math inline">\(i\)</span> have with individuals in group <span class="math inline">\(j\)</span>
</li>
<li>This average is calculated as the total number of contacts between
groups <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, divided by the number of individuals
in group <span class="math inline">\(i\)</span>
</li>
</ul>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="using-socialmixr">Using <code>socialmixr</code>
<a class="anchor" aria-label="anchor" href="#using-socialmixr"></a>
</h2>
<hr class="half-width">
<p>Contact matrices are commonly estimated from studies that use diaries
to record interactions. For example, the POLYMOD survey measured contact
patterns in 8 European countries using data on the location and duration
of contacts reported by the study participants <a href="https://doi.org/10.1371/journal.pmed.0050074" class="external-link">(Mossong et
al. 2008)</a>.</p>
<p>The R package <a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a> contains functions which can
estimate contact matrices from POLYMOD and other surveys. We can load
the POLYMOD survey data:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polymod</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="va">polymod</span></span></code></pre>
</div>
<p>Then we can obtain the contact matrix for the age categories we want
by specifying <code>age.limits</code>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_data</span> <span class="op">&lt;-</span> <span class="fu">contact_matrix</span><span class="op">(</span></span>
<span>  survey <span class="op">=</span> <span class="va">polymod</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"United Kingdom"</span>,</span>
<span>  age.limits <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_data</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$matrix
         contact.age.group
age.group   [0,20)  [20,40)      40+
  [0,20)  7.883663 3.120220 3.063895
  [20,40) 2.794154 4.854839 4.599893
  40+     1.565665 2.624868 5.005571

$demography
   age.group population proportion  year
      &lt;char&gt;      &lt;num&gt;      &lt;num&gt; &lt;int&gt;
1:    [0,20)   14799290  0.2454816  2005
2:   [20,40)   16526302  0.2741283  2005
3:       40+   28961159  0.4803901  2005

$participants
   age.group participants proportion
      &lt;char&gt;        &lt;int&gt;      &lt;num&gt;
1:    [0,20)          404  0.3996044
2:   [20,40)          248  0.2453017
3:       40+          359  0.3550940</code></pre>
</div>
<p><strong>Note: although the contact matrix
<code>contact_data$matrix</code> is not itself mathematically symmetric,
it satisfies the condition that the total number of contacts of one
group with another is the same as the reverse. In other words:
<code>contact_data$matrix[j,i]*contact_data$demography$proportion[j] = contact_data$matrix[i,j]*contact_data$demography$proportion[i]</code>.
For the mathematical explanation see <a href="https://epiforecasts.io/socialmixr/articles/socialmixr.html#symmetric-contact-matrices" class="external-link">the
corresponding section in the socialmixr documentation</a>.</strong></p>
<div id="why-would-a-contact-matrix-be-non-symmetric" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="why-would-a-contact-matrix-be-non-symmetric" class="callout-inner">
<h3 class="callout-title">Why would a contact matrix be non-symmetric?</h3>
<div class="callout-content">
<p>One of the arguments we gave the function
<code>contact_matrix()</code> is <code>symmetric=TRUE</code>. This
ensures that the total number of contacts from one group to another is
equal to the total from the second group back to the first (see the
<code>socialmixr</code> <a href="https://cran.r-project.org/web/packages/socialmixr/vignettes/socialmixr.html" class="external-link">vignette</a>
for more detail).</p>
<p>However, when contact matrices are estimated from surveys or other
sources, the <em>reported</em> number of contacts may differ by age
group for several reasons:</p>
<ul>
<li>Recall bias: Different age groups may have different abilities to
remember and report contacts accurately</li>
<li>Reporting bias: Some groups may systematically over- or under-report
their contacts</li>
<li>Sampling uncertainty: Limited sample sizes can lead to statistical
variations <a href="https://doi.org/10.1371/journal.pcbi.1009098" class="external-link">(Prem
et al 2021)</a>
</li>
</ul>
<p>If <code>symmetric</code> is set to TRUE, the
<code>contact_matrix()</code> function will internally use an average of
reported contacts to ensure the resulting total number of contacts are
symmetric.</p>
</div>
</div>
</div>
<p>The example above uses the POLYMOD survey. There are a number of
surveys available in <code>socialmixr</code>, to list the available
surveys use <code>list_surveys()</code>. To download a survey, we can
use <code>get_survey()</code></p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zambia_sa_survey</span> <span class="op">&lt;-</span> <span class="fu">get_survey</span><span class="op">(</span><span class="st">"https://doi.org/10.5281/zenodo.3874675"</span><span class="op">)</span></span></code></pre>
</div>
<div id="zambia-contact-matrix" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="zambia-contact-matrix" class="callout-inner">
<h3 class="callout-title">Zambia contact matrix</h3>
<div class="callout-content">
<p>After downloading the survey, generate a symmetric contact matrix for
Zambia using the following age bins:</p>
<ul>
<li>[0,20)</li>
<li>20+</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_data_zambia</span> <span class="op">&lt;-</span> <span class="fu">contact_matrix</span><span class="op">(</span></span>
<span>  survey <span class="op">=</span> <span class="va">zambia_sa_survey</span>,</span>
<span>  age.limits <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Removing participants without age information. To change this behaviour, set the 'missing.participant.age' option</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_data_zambia</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$matrix
         contact.age.group
age.group   [0,20)      20+
   [0,20) 3.643137 2.282138
   20+    1.795546 2.542346

$demography
   age.group population proportion  year
      &lt;char&gt;      &lt;num&gt;      &lt;num&gt; &lt;int&gt;
1:    [0,20)   28813173  0.4403347  2010
2:       20+   36621532  0.5596653  2010

$participants
   age.group participants proportion
      &lt;char&gt;        &lt;int&gt;      &lt;num&gt;
1:    [0,20)          255 0.07535461
2:       20+         3129 0.92464539</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="synthetic-contact-matrices" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="synthetic-contact-matrices" class="callout-inner">
<h3 class="callout-title">Synthetic contact matrices</h3>
<div class="callout-content">
<p>Contact matrices can be estimated from data obtained from diary (such
as POLYMOD), survey or contact data, or synthetic ones can be used. <a href="https://doi.org/10.1371/journal.pcbi.1009098" class="external-link">Prem et al. 2021</a>
used the POLYMOD data within a Bayesian hierarchical model to project
contact matrices for 177 other countries.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="analyses-with-contact-matrices">Analyses with contact matrices<a class="anchor" aria-label="anchor" href="#analyses-with-contact-matrices"></a>
</h2>
<hr class="half-width">
<p>Contact matrices can be used in a wide range of epidemiological
analyses, they can be used:</p>
<ul>
<li>to calculate the basic reproduction number while accounting for
different rates of contacts between age groups <a href="https://doi.org/10.1186/s12916-019-1413-7" class="external-link">(Funk et
al. 2019)</a>,</li>
<li>to calculate final size of an epidemic, as in the R package
<a href="https://github.com/epiverse-trace/finalsize" class="external-link">finalsize</a>,</li>
<li>to assess the impact of interventions finding the relative change
between pre and post intervention contact matrices to calculate the
relative difference in <span class="math inline">\(R_0\)</span> <a href="https://doi.org/10.1186/s12916-020-01597-8" class="external-link">(Jarvis et
al. 2020)</a>,</li>
<li>and in mathematical models of transmission within a population, to
account for group specific contact patterns.</li>
</ul>
<p>However, all of these applications require us to perform some
additional calculations using the contact matrix. Specifically, there
are two main calculations we often need to do:</p>
<ol style="list-style-type: decimal">
<li><strong>Convert contact matrix into expected number of secondary
cases</strong></li>
</ol>
<p>If contacts vary between groups, then the average number of secondary
cases won’t be equal simply to the average number of contacts multiplied
by the probability of transmission-per-contact. This is because the
average amount of transmission in each generation of infection isn’t
just a matter of whom a group came into contact with; it’s about whom
<em>their contacts</em> subsequently come into contact with. The
function <code>r_eff</code> in the package <a href="https://github.com/epiverse-trace/finalsize" class="external-link">finalsize</a> can
perform this conversion, taking a contact matrix, demography and
proportion susceptible and converting it into an estimate of the average
number of secondary cases generated by a typical infectious individual
(i.e. the effective reproduction number).</p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Convert contact matrix into contact rates</strong></li>
</ol>
<p>Whereas a contact matrix gives the average number of contacts that
one groups makes with another, epidemic dynamics in different groups
depend on the rate at which one group infects another. We therefore need
to scale the rate of interaction between different groups (i.e. the
number of contacts per unit time) to get the rate of transmission.
However, we need to be careful that we are defining transmission to and
from each group correctly in any model. Specifically, the entry <span class="math inline">\((i,j)\)</span> in a mathematical model contact
matrix represents contacts of group <span class="math inline">\(i\)</span> with group <span class="math inline">\(j\)</span>. But if we want to know the rate at
which a group <span class="math inline">\(i\)</span> are getting
infected, then we want to multiply the number of contacts of
susceptibles in group <span class="math inline">\(i\)</span> (<span class="math inline">\(S_i\)</span>) with group <span class="math inline">\(j\)</span> (<span class="math inline">\(C[i,j]\)</span>) with the proportion of those
contacts that are infectious (<span class="math inline">\(I_j/N_j\)</span>), and the transmission risk per
contact (<span class="math inline">\(\beta\)</span>).</p>
<div class="section level3">
<h3 id="in-mathematical-models">In mathematical models<a class="anchor" aria-label="anchor" href="#in-mathematical-models"></a>
</h3>
<p>Consider the SIR model where individuals are categorized as either
susceptible <span class="math inline">\(S\)</span>, infected but not yet
infectious <span class="math inline">\(E\)</span>, infectious <span class="math inline">\(I\)</span> or recovered <span class="math inline">\(R\)</span>. The schematic below shows the
processes which describe the flow of individuals between the disease
states <span class="math inline">\(S\)</span>, <span class="math inline">\(I\)</span> and <span class="math inline">\(R\)</span> and the key parameters for each
process.</p>
<figure><img src="fig/contact-matrices-rendered-diagram-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The <a href="reference.html#ordinary">differential equations</a>
below describe how individuals move from one state to another <a href="https://doi.org/10.1038/s41592-020-0822-z" class="external-link">(Bjørnstad et
al. 2020)</a>.</p>
<p><span class="math display">\[
\begin{aligned}
\frac{dS}{dt} &amp; = - \beta S I /N \\
\frac{dI}{dt} &amp;= \beta S I /N - \gamma I \\
\frac{dR}{dt} &amp;=\gamma I \\
\end{aligned}
\]</span> To add age structure to our model, we need to add additional
equations for the infection states <span class="math inline">\(S\)</span>, <span class="math inline">\(I\)</span>
and <span class="math inline">\(R\)</span> for each age group <span class="math inline">\(i\)</span>. If we want to assume that there is
heterogeneity in contacts between age groups then we must adapt the
transmission term <span class="math inline">\(\beta SI\)</span> to
include the contact matrix <span class="math inline">\(C\)</span> as
follows :</p>
<p><span class="math display">\[ \beta S_i \sum_j C_{i,j} I_j/N_j.
\]</span></p>
<p>Susceptible individuals in age group <span class="math inline">\(i\)</span> become infected dependent on their rate
of contact with individuals in each age group. For each disease state
(<span class="math inline">\(S\)</span>, <span class="math inline">\(E\)</span>, <span class="math inline">\(I\)</span>
and <span class="math inline">\(R\)</span>) and age group (<span class="math inline">\(i\)</span>), we have a differential equation
describing the rate of change with respect to time.</p>
<p><span class="math display">\[
\begin{aligned}
\frac{dS_i}{dt} &amp; = - \beta S_i \sum_j C_{i,j} I_j/N_j \\
\frac{dI_i}{dt} &amp;= \beta S_i\sum_j C_{i,j} I_j/N_j - \gamma I_i \\
\frac{dR_i}{dt} &amp;=\gamma I_i \\
\end{aligned}
\]</span></p>
</div>
<div class="section level3">
<h3 id="normalising-the-contact-matrix-to-ensure-the-correct-value-of-r_0">Normalising the contact matrix to ensure the correct value of <span class="math inline">\(R_0\)</span>
<a class="anchor" aria-label="anchor" href="#normalising-the-contact-matrix-to-ensure-the-correct-value-of-r_0"></a>
</h3>
<p>When simulating an epidemic, we often want to ensure that the average
number of secondary cases generated by a typical infectious individual
(i.e. <span class="math inline">\(R_0\)</span>) is consistent with known
values for the pathogen we’re analysing. In the above model, we scale
the contact matrix by the <span class="math inline">\(\beta\)</span> to
convert the raw interaction data into a transmission rate. But how do we
define the value of <span class="math inline">\(\beta\)</span> to ensure
a certain value of <span class="math inline">\(R_0\)</span>?</p>
<p>Rather than just using the raw number of contacts, we can instead
normalise the contact matrix to make it easier to work in terms of <span class="math inline">\(R_0\)</span>. In particular, we normalise the
matrix by scaling it so that if we were to calculate the average number
of secondary cases based on this normalised matrix, the result would be
1 (in mathematical terms, we are scaling the matrix so the largest
eigenvalue is 1). This transformation scales the entries but preserves
their relative values.</p>
<p>In the case of the above model, we want to define <span class="math inline">\(\beta  C_{i,j}\)</span> so that the model has a
specified valued of <span class="math inline">\(R_0\)</span>. If the
entry of the contact matrix <span class="math inline">\(C[i,j]\)</span>
represents the contacts of population <span class="math inline">\(i\)</span> with <span class="math inline">\(j\)</span>, it is equivalent to
<code>contact_data$matrix[i,j]</code>, and the maximum eigenvalue of
this matrix represents the typical magnitude of contacts, not typical
magnitude of transmission. We must therefore normalise the matrix <span class="math inline">\(C\)</span> so the maximum eigenvalue is one; we
call this matrix <span class="math inline">\(C_{normalised}\)</span>.
Because the rate of recovery is <span class="math inline">\(\gamma\)</span>, individuals will be infectious on
average for <span class="math inline">\(1/\gamma\)</span> days. So <span class="math inline">\(\beta\)</span> as a model input is calculated from
<span class="math inline">\(R_0\)</span>, the scaling factor and the
value of <span class="math inline">\(\gamma\)</span>
(i.e. mathematically we use the fact that the dominant eigenvalue of the
matrix <span class="math inline">\(R_0 \times C_{normalised}\)</span> is
equal to <span class="math inline">\(\beta / \gamma\)</span>).</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="fu">t</span><span class="op">(</span><span class="va">contact_data</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span><span class="va">scaling_factor</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu">max</span><span class="op">(</span><span class="fu">eigen</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span>
<span><span class="va">normalised_matrix</span> <span class="op">&lt;-</span> <span class="va">contact_matrix</span> <span class="op">*</span> <span class="va">scaling_factor</span></span></code></pre>
</div>
<p>As a result, if we multiply the scaled matrix by <span class="math inline">\(R_0\)</span>, then converting to the number of
expected secondary cases would give us <span class="math inline">\(R_0\)</span>, as required.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">infectious_period</span> <span class="op">&lt;-</span> <span class="fl">7.0</span></span>
<span><span class="va">basic_reproduction</span> <span class="op">&lt;-</span> <span class="fl">1.46</span></span>
<span><span class="va">transmission_rate</span> <span class="op">&lt;-</span> <span class="va">basic_reproduction</span> <span class="op">*</span> <span class="va">scaling_factor</span> <span class="op">/</span> <span class="va">infectious_period</span></span>
<span><span class="co"># check the dominant eigenvalue of R0 x C_normalised is R0</span></span>
<span><span class="fu">max</span><span class="op">(</span><span class="fu">eigen</span><span class="op">(</span><span class="va">basic_reproduction</span> <span class="op">*</span> <span class="va">normalised_matrix</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.46</code></pre>
</div>
<div id="normalisation-using-socialmixr" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="normalisation-using-socialmixr" class="callout-inner">
<h3 class="callout-title">Normalisation using
<code>socialmixr</code>
</h3>
<div class="callout-content">
<p>Normalisation can be performed by the function
<code>contact_matrix()</code> in <a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a>. To obtain
the normalised matrix we must specify that we want to split out the
different components of the contact matrix using the argument
<code>split = TRUE</code>. Then we can obtain the normalised matrix as
follows:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_data_split</span> <span class="op">&lt;-</span> <span class="fu">contact_matrix</span><span class="op">(</span></span>
<span>  survey <span class="op">=</span> <span class="va">polymod</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"United Kingdom"</span>,</span>
<span>  age.limits <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  split <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract components of the contact matrix</span></span>
<span><span class="va">contacts_d</span> <span class="op">&lt;-</span> <span class="va">contact_data_split</span><span class="op">$</span><span class="va">contacts</span></span>
<span><span class="va">matrix_a</span> <span class="op">&lt;-</span> <span class="va">contact_data_split</span><span class="op">$</span><span class="va">matrix</span></span>
<span><span class="va">demography_n</span> <span class="op">&lt;-</span> <span class="va">contact_data_split</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">proportion</span></span>
<span></span>
<span><span class="co"># calculate normalised matrix</span></span>
<span><span class="va">normalised_matrix_split</span> <span class="op">&lt;-</span> <span class="va">contacts_d</span> <span class="op">*</span> <span class="va">matrix_a</span> <span class="op">*</span> <span class="va">demography_n</span></span></code></pre>
</div>
<p>For details of the different components of the contact matrix see <a href="https://cran.r-project.org/web/packages/socialmixr/vignettes/socialmixr.html#splitting-contact-matrices" class="external-link">the
package vignette on splitting contact matrices.</a></p>
</div>
</div>
</div>
<div id="check-the-dimension-of-beta" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="check-the-dimension-of-beta" class="callout-inner">
<h3 class="callout-title">Check the dimension of <span class="math inline">\(\beta\)</span>
</h3>
<div class="callout-content">
<p>In the SIR model without age structure the rate of contact is part of
the transmission rate <span class="math inline">\(\beta\)</span>, where
as in the age-structured model we have separated out the rate of
contact, hence the transmission rate <span class="math inline">\(\beta\)</span> in the age structured model will
have a different value.</p>
</div>
</div>
</div>
<p>We can use contact matrices from <code>socialmixr</code> with
mathematical models in the R package <code>{epidemics}</code>. See the
tutorial <a href="simulating-transmission.html">Simulating
transmission</a> for examples and an introduction to
<code>epidemics</code>.</p>
</div>
<div class="section level3">
<h3 id="contact-groups">Contact groups<a class="anchor" aria-label="anchor" href="#contact-groups"></a>
</h3>
<p>In the example above the dimension of the contact matrix will be the
same as the number of age groups i.e. if there are 3 age groups then the
contact matrix will have 3 rows and 3 columns. Contact matrices can be
used for other groups as long as the dimension of the matrix matches the
number of groups.</p>
<p>For example, we might have a meta population model with two
geographic areas. Then our contact matrix would be a 2 x 2 matrix with
entries representing the contact between and within the geographic
areas.</p>
</div>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<p>In this tutorial, we have learnt the definition of the contact
matrix, how they are estimated and how to access social contact data
from <code>socialmixr</code>. In the next tutorial, we will learn how to
use the R package <code>{epidemics}</code> to generate disease
trajectories from mathematical models with contact matrices from
<code>socialmixr</code>.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Contact matrices quantify the mixing patterns between different
population groups</li>
<li>
<code>socialmixr</code> provides tools to estimate contact matrices
from survey data</li>
<li>Contact matrices can be used in various epidemiological analyses,
from calculating <span class="math inline">\(R_0\)</span> to modeling
interventions</li>
<li>Proper normalization is crucial when using contact matrices in
transmission models</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-simulating-transmission"><p>Content from <a href="simulating-transmission.html">Simulating transmission</a></p>
<hr>
<p>Last updated on 2025-05-06 |

        <a href="https://github.com/epiverse-trace/tutorials-late/edit/main/episodes/simulating-transmission.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I simulate disease spread using a mathematical model?</li>
<li>What inputs are needed for a model simulation?</li>
<li>How do I account for uncertainty?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Load an existing model structure from <code>{epidemics}</code> R
package</li>
<li>Load an existing social contact matrix with
<a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a>
</li>
<li>Generate a disease spread model simulation with
<code>{epidemics}</code>
</li>
<li>Generate multiple model simulations and visualise uncertainty</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="prereq1" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Prerequisite</h3>
<div class="callout-content">
<p>Learners should familiarise themselves with following concept
dependencies before working through this tutorial:</p>
<p><strong>Mathematical Modelling</strong> : <a href="https://doi.org/10.1038/s41592-020-0856-2" class="external-link">Introduction to
infectious disease models</a>, <a href="reference.html#state">state
variables</a>, <a href="reference.html#parsode">model parameters</a>, <a href="reference.html#initial">initial conditions</a>, <a href="reference.html#ordinary">differential equations</a>.</p>
<p><strong>Epidemic theory</strong> : <a href="https://doi.org/10.1155/2011/267049" class="external-link">Transmission</a>, <a href="https://doi.org/10.3201/eid2501.171901" class="external-link">Reproduction
number</a>.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>Mathematical models are useful tools for generating future
trajectories of disease spread. In this tutorial, we will use the R
package <code>{epidemics}</code> to generate disease trajectories of an
influenza strain with pandemic potential. By the end of this tutorial,
you will be able to generate the trajectory below showing the number of
infectious individuals in different age categories over time.</p>
<p>In this tutorial we are going to learn how to use the
<code>{epidemics}</code> package to simulate disease trajectories and
access to social contact data with <a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a>. We’ll use
<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>, <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a> and the pipe
<code>%&gt;%</code> to connect some of their functions, so let’s also
call to the <a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a> package:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">epidemics</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">socialmixr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/simulating-transmission-rendered-traj-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="simulating-disease-spread">Simulating disease spread<a class="anchor" aria-label="anchor" href="#simulating-disease-spread"></a>
</h2>
<hr class="half-width">
<p>To simulate infectious disease trajectories, we must first select a
mathematical model to use. There is a library of models to choose from
in <code>{epidemics}</code>. These are prefixed with
<code>model_*</code> and suffixed by the name of infection
(e.g. <code>model_ebola</code> for Ebola) or a different identifier
(e.g. <code>model_default</code>).</p>
<p>In this tutorial, we will use the default model in
<code>{epidemics}</code>, called <code>model_default()</code>, which is
designed to be an age-structured model that categorises individuals
based on their infection status. For each age group <span class="math inline">\(i\)</span>, individuals are categorized as either
susceptible <span class="math inline">\(S\)</span>, infected but not yet
infectious <span class="math inline">\(E\)</span>, infectious <span class="math inline">\(I\)</span> or recovered <span class="math inline">\(R\)</span>. Next, we need to define the process by
which individuals flow from one compartment to another. This can be done
by defining a set of <a href="reference.html#ordinary">differential
equations</a> that specify how the number of individuals in each
compartment changes over time.</p>
<p>The schematic below shows the processes which describe the flow of
individuals between the disease states <span class="math inline">\(S\)</span>, <span class="math inline">\(E\)</span>, <span class="math inline">\(I\)</span>
and <span class="math inline">\(R\)</span> and the key parameters for
each process.</p>
<figure><img src="fig/simulating-transmission-rendered-diagram-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="model-parameters-rates" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="model-parameters-rates" class="callout-inner">
<h3 class="callout-title">Model parameters: rates</h3>
<div class="callout-content">
<p>In population-level models defined by differential equations, model
parameters are often (but not always) specified as rates. The rate at
which an event occurs is the inverse of the average time until that
event. For example, in the SEIR model, the recovery rate <span class="math inline">\(\gamma\)</span> is the inverse of the average
infectious period.</p>
<p>Values of these rates can be determined from the natural history of
the disease. For example, if people are on average infectious for 8
days, then in the model, 1/8 of currently infectious people would
recover each day (i.e. the rate of recovery, <span class="math inline">\(\gamma=1/8=0.125\)</span>).</p>
</div>
</div>
</div>
<p>For each disease state (<span class="math inline">\(S\)</span>, <span class="math inline">\(E\)</span>, <span class="math inline">\(I\)</span>
and <span class="math inline">\(R\)</span>) and age group (<span class="math inline">\(i\)</span>), we have a differential equation
describing the rate of change with respect to time.</p>
<p><span class="math display">\[
\begin{aligned}
\frac{dS_i}{dt} &amp; = - \beta S_i \sum_j C_{i,j} I_j/N_j \\
\frac{dE_i}{dt} &amp;= \beta S_i\sum_j C_{i,j} I_j/N_j - \alpha E_i \\
\frac{dI_i}{dt} &amp;= \alpha E_i - \gamma I_i \\
\frac{dR_i}{dt} &amp;=\gamma I_i \\
\end{aligned}
\]</span></p>
<p>Individuals in age group (<span class="math inline">\(i\)</span>)
move from the susceptible state (<span class="math inline">\(S_i\)</span>) to the exposed state (<span class="math inline">\(E_i\)</span>) via age-specific contacts with
infectious individuals in all groups <span class="math inline">\(\beta
S_i \sum_j C_{i,j} I_j/N_j\)</span>. The contact matrix <span class="math inline">\(C\)</span> allows for heterogeneity in contacts
between age groups. They then move to the infectious state at a rate
<span class="math inline">\(\alpha\)</span> and recover at a rate <span class="math inline">\(\gamma\)</span>. Note that this model assumes no
loss of immunity (there are no flows out of the recovered state), which
may not be applicable for all diseases as some allow for
reinfection.</p>
<p>The model parameters are:</p>
<ul>
<li>transmission rate <span class="math inline">\(\beta\)</span>
(derived from the basic reproduction number <span class="math inline">\(R_0\)</span> and the recovery rate <span class="math inline">\(\gamma\)</span>),</li>
<li>
<a href="reference.html#contact">contact matrix</a> <span class="math inline">\(C\)</span> containing the frequency of contacts
between age groups (a square <span class="math inline">\(i \times
j\)</span> matrix),</li>
<li>infectiousness rate <span class="math inline">\(\alpha\)</span>
(pre-infectious period, or <a href="reference.html#latent">latent
period</a> =<span class="math inline">\(1/\alpha\)</span>), and</li>
<li>recovery rate <span class="math inline">\(\gamma\)</span>
(infectious period = <span class="math inline">\(1/\gamma\)</span>).</li>
</ul>
<div id="exposed-infected-infectious" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="exposed-infected-infectious" class="callout-inner">
<h3 class="callout-title">Exposed, infected, infectious</h3>
<div class="callout-content">
<p>Confusion sometimes arises when referring to the terms ‘exposed’,
‘infected’ and ‘infectious’ in mathematical modelling. Infection occurs
after a person has been exposed, but in modelling terms individuals that
are ‘exposed’ are treated as already infected.</p>
<p>We will use the following definitions for our state variables:</p>
<ul>
<li>
<span class="math inline">\(E\)</span> = Exposed : infected
<strong>but not yet</strong> infectious,</li>
<li>
<span class="math inline">\(I\)</span> = Infectious: infected
<strong>and</strong> infectious.</li>
</ul>
</div>
</div>
</div>
<p>To generate trajectories using our model, we must prepare the
following inputs:</p>
<ol style="list-style-type: decimal">
<li>Contact matrix</li>
<li>Initial conditions</li>
<li>Population structure</li>
<li>Model parameters</li>
</ol>
<div class="section level3">
<h3 id="contact-matrix">1. Contact matrix<a class="anchor" aria-label="anchor" href="#contact-matrix"></a>
</h3>
<p>A contact matrix represents the average number of contacts between
individuals in different age groups. It is a crucial component in
age-structured models as it captures how different age groups interact
and potentially transmit infections. We will use the R package
<a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a> to load a contact matrix estimated from
POLYMOD survey data <a href="https://doi.org/10.1371/journal.pmed.0050074" class="external-link">(Mossong et
al. 2008)</a>.</p>
<div id="load-contact-and-population-data" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="load-contact-and-population-data" class="callout-inner">
<h3 class="callout-title">Load contact and population data</h3>
<div class="callout-content">
<p>Using the R package <code>socialmixr</code>, run the following lines
of R code to obtain the contact matrix for the United Kingdom for the
year age bins:</p>
<ul>
<li>age between 0 and 20 years,</li>
<li>age between 20 and 40,</li>
<li>40 years and over.</li>
</ul>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polymod</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="va">polymod</span></span>
<span><span class="va">contact_data</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="fu">contact_matrix</span><span class="op">(</span></span>
<span>  survey <span class="op">=</span> <span class="va">polymod</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"United Kingdom"</span>,</span>
<span>  age.limits <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># prepare contact matrix</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="fu">t</span><span class="op">(</span><span class="va">contact_data</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span><span class="va">contact_matrix</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                 age.group
contact.age.group   [0,20)  [20,40)      40+
          [0,20)  7.883663 2.794154 1.565665
          [20,40) 3.120220 4.854839 2.624868
          40+     3.063895 4.599893 5.005571</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The result is a square matrix with rows and columns for each age
group. Contact matrices can be loaded from other sources, but they must
be formatted as a matrix to be used in <code>epidemics</code>.</p>
<div id="normalisation" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="normalisation" class="callout-inner">
<h3 class="callout-title">Normalisation</h3>
<div class="callout-content">
<p>In <code>{epidemics}</code> the contact matrix normalisation happens
within the function call, so we don’t need to normalise the contact
matrix before we pass it to <code>population()</code> (see section 3.
Population Structure). For details on normalisation, see the tutorial on
<a href="%5BSimulating%20transmission%5D(../episodes/contact-matrices.md)">contact
matrices</a> .</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="initial-conditions">2. Initial conditions<a class="anchor" aria-label="anchor" href="#initial-conditions"></a>
</h3>
<p>The initial conditions are the proportion of individuals in each
disease state <span class="math inline">\(S\)</span>, <span class="math inline">\(E\)</span>, <span class="math inline">\(I\)</span>
and <span class="math inline">\(R\)</span> for each age group at time 0.
In this example, we have three age groups age between 0 and 20 years,
age between 20 and 40 years and over. Let’s assume that in the youngest
age category, one in a million individuals are infectious, and the
remaining age categories are infection free.</p>
<p>The initial conditions in the first age category are <span class="math inline">\(S(0)=1-\frac{1}{1,000,000}\)</span>, <span class="math inline">\(E(0) =0\)</span>, <span class="math inline">\(I(0)=\frac{1}{1,000,000}\)</span>, <span class="math inline">\(R(0)=0\)</span>. This is specified as a vector as
follows:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_i</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span></span>
<span><span class="va">initial_conditions_inf</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span></span>
<span>  S <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">initial_i</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="va">initial_i</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>For the age categories that are free from infection, the initial
conditions are <span class="math inline">\(S(0)=1\)</span>, <span class="math inline">\(E(0) =0\)</span>, <span class="math inline">\(I(0)=0\)</span>, <span class="math inline">\(R(0)=0\)</span>. We specify this as follows,</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_conditions_free</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span></span>
<span>  S <span class="op">=</span> <span class="fl">1</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="fl">0</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>We combine the three initial conditions vectors into one matrix,</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># combine the initial conditions</span></span>
<span><span class="va">initial_conditions</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span></span>
<span>  <span class="va">initial_conditions_inf</span>, <span class="co"># age group 1</span></span>
<span>  <span class="va">initial_conditions_free</span>, <span class="co"># age group 2</span></span>
<span>  <span class="va">initial_conditions_free</span> <span class="co"># age group 3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use contact matrix to assign age group names</span></span>
<span><span class="fu">rownames</span><span class="op">(</span><span class="va">initial_conditions</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">rownames</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span></span>
<span><span class="va">initial_conditions</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>               S E     I R V
[0,20)  0.999999 0 1e-06 0 0
[20,40) 1.000000 0 0e+00 0 0
40+     1.000000 0 0e+00 0 0</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="population-structure">3. Population structure<a class="anchor" aria-label="anchor" href="#population-structure"></a>
</h3>
<p>The population object requires a vector containing the demographic
structure of the population. The demographic vector must be a named
vector containing the number of individuals in each age group of our
given population. In this example, we can extract the demographic
information from the <code>contact_data</code> object that we obtained
using the <code>socialmixr</code> package.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demography_vector</span> <span class="op">&lt;-</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">population</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">demography_vector</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">rownames</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span></span>
<span><span class="va">demography_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  [0,20)  [20,40)      40+
14799290 16526302 28961159 </code></pre>
</div>
<p>To create our population object, from the <code>{epidemics}</code>
package we call the function <code>population()</code> specifying a
name, the contact matrix, the demography vector and the initial
conditions.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">epidemics</span><span class="op">)</span></span>
<span></span>
<span><span class="va">uk_population</span> <span class="op">&lt;-</span> <span class="fu">population</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"UK"</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector</span>,</span>
<span>  initial_conditions <span class="op">=</span> <span class="va">initial_conditions</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="model-parameters">4. Model parameters<a class="anchor" aria-label="anchor" href="#model-parameters"></a>
</h3>
<p>To run our model we need to specify the model parameters:</p>
<ul>
<li>transmission rate <span class="math inline">\(\beta\)</span>,</li>
<li>infectiousness rate <span class="math inline">\(\alpha\)</span>
(preinfectious period=<span class="math inline">\(1/\alpha\)</span>),</li>
<li>recovery rate <span class="math inline">\(\gamma\)</span>
(infectious period=<span class="math inline">\(1/\gamma\)</span>).</li>
</ul>
<p>In <code>epidemics</code>, we specify the model inputs as :</p>
<ul>
<li>
<code>transmission_rate</code> <span class="math inline">\(\beta =
R_0 \gamma\)</span>,</li>
<li>
<code>infectiousness_rate</code> = <span class="math inline">\(\alpha\)</span>,</li>
<li>
<code>recovery_rate</code> = <span class="math inline">\(\gamma\)</span>,</li>
</ul>
<p>We will simulate a strain of influenza with pandemic potential with
<span class="math inline">\(R_0=1.46\)</span>, with a pre-infectious
period of 3 days and infectious period of 7 days. Therefore our inputs
will be:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># time periods</span></span>
<span><span class="va">preinfectious_period</span> <span class="op">&lt;-</span> <span class="fl">3.0</span></span>
<span><span class="va">infectious_period</span> <span class="op">&lt;-</span> <span class="fl">7.0</span></span>
<span><span class="va">basic_reproduction</span> <span class="op">&lt;-</span> <span class="fl">1.46</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rates</span></span>
<span><span class="va">infectiousness_rate</span> <span class="op">&lt;-</span> <span class="fl">1.0</span> <span class="op">/</span> <span class="va">preinfectious_period</span></span>
<span><span class="va">recovery_rate</span> <span class="op">&lt;-</span> <span class="fl">1.0</span> <span class="op">/</span> <span class="va">infectious_period</span></span>
<span><span class="va">transmission_rate</span> <span class="op">&lt;-</span> <span class="va">basic_reproduction</span> <span class="op">/</span> <span class="va">infectious_period</span></span></code></pre>
</div>
<div id="the-basic-reproduction-number-r_0" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-basic-reproduction-number-r_0" class="callout-inner">
<h3 class="callout-title">The basic reproduction number <span class="math inline">\(R_0\)</span>
</h3>
<div class="callout-content">
<p>The basic reproduction number, <span class="math inline">\(R_0\)</span>, for the SEIR model is:</p>
<p><span class="math display">\[ R_0 =
\frac{\beta}{\gamma}.\]</span></p>
<p>Therefore, we can rewrite transmission rate <span class="math inline">\(\beta\)</span> as:</p>
<p><span class="math display">\[ \beta = R_0 \gamma.\]</span></p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="running-the-model">Running the model<a class="anchor" aria-label="anchor" href="#running-the-model"></a>
</h2>
<hr class="half-width">
<div id="running-solving-the-model" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="running-solving-the-model" class="callout-inner">
<h3 class="callout-title">Running (solving) the model</h3>
<div class="callout-content">
<p>For models that are described by <a href="reference.html#ordinary">differential equations</a>, ‘running’ the
model actually means to take the system of differential equations and
‘solve’ them to find out how the number of people in the underlying
compartments change over time. Because differential equations describe
the rate of change in the disease states with respect to time, rather
than the number of individuals in each of these states, we typically
need to use numerical methods to solve the equations.</p>
<p>An <em>ODE solver</em> is the software used to find numerical
solutions to differential equations. If interested on how a system of
differential equations is solved in <code>{epidemics}</code>, we suggest
you to read the section on <a href="https://epiverse-trace.github.io/epidemics/articles/design-principles.html#ode-systems-and-models" class="external-link">ODE
systems and models</a> at the “Design principles” vignette.</p>
</div>
</div>
</div>
<p>Now we are ready to run our model using <code>model_default()</code>
from the <code>{epidemics}</code> package.</p>
<p>Let’s specify <code>time_end=600</code> to run the model for 600
days.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model_default</span><span class="op">(</span></span>
<span>  <span class="co"># population</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  <span class="co"># rates</span></span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  <span class="co"># time</span></span>
<span>  time_end <span class="op">=</span> <span class="fl">600</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    time demography_group compartment    value
   &lt;num&gt;           &lt;char&gt;      &lt;char&gt;    &lt;num&gt;
1:     0           [0,20) susceptible 14799275
2:     0          [20,40) susceptible 16526302
3:     0              40+ susceptible 28961159
4:     0           [0,20)     exposed        0
5:     0          [20,40)     exposed        0
6:     0              40+     exposed        0</code></pre>
</div>
<p><em>Note: This model also has the functionality to include
vaccination and tracks the number of vaccinated individuals through
time. Even though we have not specified any vaccination, there is still
a vaccinated compartment in the output (containing no individuals). We
will cover the use of vaccination in future tutorials.</em></p>
<p>Our model output consists of the number of individuals in each
compartment in each age group through time. We can visualise the
infectious individuals only (those in the <span class="math inline">\(I\)</span> class) through time.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">time</span>,</span>
<span>      y <span class="op">=</span> <span class="va">value</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">demography_group</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"Compartment"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/simulating-transmission-rendered-visualise-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="time-increments" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="time-increments" class="callout-inner">
<h3 class="callout-title">Time increments</h3>
<div class="callout-content">
<p>Note that there is a default argument of <code>increment = 1</code>.
This relates to the time step of the ODE solver. When the parameters are
specified on a daily time-scale and maximum number of time steps
(<code>time_end</code>) is days, the default time step of the ODE solver
one day.</p>
<p>The choice of increment will depend on the time scale of the
parameters, and the rate at which events can occur. In general, the
increment should be smaller than the fastest event that can occur. For
example:</p>
<ul>
<li>if parameters are on a daily time scale, and all events are reported
on a daily basis, then the increment should be equal to one day;</li>
<li>if parameters are on a monthly time scale, but some events will
occur within a month, then the increment should be less than one
month.</li>
</ul>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="accounting-for-uncertainty">Accounting for uncertainty<a class="anchor" aria-label="anchor" href="#accounting-for-uncertainty"></a>
</h2>
<hr class="half-width">
<p>The epidemic model is <a href="reference.html#deterministic">deterministic</a>, which means it
runs like clockwork: the same parameters will always lead to the same
trajectory. A deterministic model is one where the outcome is completely
determined by the initial conditions and parameters, with no random
variation. However, reality is not so predictable. There are two main
reasons for this: the transmission process can involve randomness, and
we may not know the exact epidemiological characteristics of the
pathogen we’re interested in. In the next episode, we will consider
‘stochastic’ models (i.e. models where we can define the process that
creates randomness in transmission). In the meantime, we can include
uncertainty in the value of the parameters that go into the
deterministic model. To account for this, we must run our model for
different parameter combinations.</p>
<p>We ran our model with <span class="math inline">\(R_0= 1.5\)</span>.
However, we believe that <span class="math inline">\(R_0\)</span>
follows a normal distribution with mean 1.5 and standard deviation 0.05.
To account for uncertainty we will run the model for different values of
<span class="math inline">\(R_0\)</span>. The steps we will follow to do
this are:</p>
<ol style="list-style-type: decimal">
<li>Obtain 100 samples from the from a normal distribution</li>
</ol>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify the mean and standard deviation of R0</span></span>
<span><span class="va">r_estimate_mean</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span>
<span><span class="va">r_estimate_sd</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span></span>
<span><span class="co"># Generate 100 R samples</span></span>
<span><span class="va">r_samples</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu">with_seed</span><span class="op">(</span></span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="fu">rnorm</span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fl">100</span>, mean <span class="op">=</span> <span class="va">r_estimate_mean</span>, sd <span class="op">=</span> <span class="va">r_estimate_sd</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">infectious_period</span> <span class="op">&lt;-</span> <span class="fl">7</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="va">r_samples</span> <span class="op">/</span> <span class="va">infectious_period</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Run the model 100 times with <span class="math inline">\(R_0\)</span> equal to a different sample each
time</li>
</ol>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_samples</span> <span class="op">&lt;-</span> <span class="fu">model_default</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  transmission_rate <span class="op">=</span> <span class="va">beta</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">600</span>, increment <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Calculate the mean and 95% quantiles of number of infectious
individuals across each model simulation and visualise output</li>
</ol>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_samples</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>r_value <span class="op">=</span> <span class="va">r_samples</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span>, color <span class="op">=</span> <span class="va">r_value</span>, group <span class="op">=</span> <span class="va">param_set</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_fermenter</span><span class="op">(</span></span>
<span>    palette <span class="op">=</span> <span class="st">"RdBu"</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"R"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">demography_group</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/simulating-transmission-rendered-plot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Deciding which parameters to include uncertainty in depends on a few
factors: how well informed a parameter value is e.g. consistency of
estimates from the literature; how sensitive model outputs are to
parameter value changes; and the purpose of the modelling task. See <a href="https://doi.org/10.1016%2Fj.epidem.2021.100520" class="external-link">McCabe et
al. 2021</a> to learn about different types of uncertainty in infectious
disease modelling.</p>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<p>In this tutorial, we have learnt how to simulate disease spread using
a mathematical model. Once a model has been chosen, the parameters and
other inputs must be specified in the correct way to perform model
simulations. In the next tutorial, we will consider how to choose the
right model for different tasks.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Disease trajectories can be generated using the R package
<code>epidemics</code>
</li>
<li>Uncertainty should be included in model trajectories using a range
of model parameter values</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-model-choices"><p>Content from <a href="model-choices.html">Choosing an appropriate model</a></p>
<hr>
<p>Last updated on 2025-05-06 |

        <a href="https://github.com/epiverse-trace/tutorials-late/edit/main/episodes/model-choices.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I choose a mathematical model that’s appropriate to complete
my analytical task?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the model requirements for a specific research
question</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="prereq1" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Prerequisite</h3>
<div class="callout-content">
<ul>
<li>Complete tutorial <a href="simulating-transmission.html">Simulating
transmission</a>
</li>
</ul>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>There are existing mathematical models for different infections,
interventions and transmission patterns which can be used to answer new
questions. In this tutorial, we will learn how to choose an existing
model to complete a given task.</p>

<div id="choosing-a-model" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="choosing-a-model" class="callout-inner">
<h3 class="callout-title">Choosing a model</h3>
<div class="callout-content">
<p>When deciding which mathematical model to use, there are a number of
questions we must consider :</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> What is the infection/disease of interest? </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>A model may already exist for your study disease, or there may be a
model for an infection that has similar transmission pathways and
epidemiological features that can be adapted. For example, diseases with
similar transmission routes (e.g., airborne, droplet, or contact
transmission) and similar natural history (e.g., incubation period,
infectious period) may use similar model structures.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Do we need a deterministic or stochastic model? </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Model structures differ depending on the scale and nature of the
outbreak. When simulated numbers of infection are small, stochastic
variation (i.e. randomness that we can define mathematically) in output
can significantly affect whether an outbreak takes off or not.
Outbreaks, which are typically localized events, may be better modeled
using stochastic approaches to capture the uncertainty in early
transmission dynamics. Epidemics, which are larger-scale events, can
often be effectively modeled using deterministic approaches as the
stochastic variation becomes less significant relative to the overall
dynamics. It’s important to note that the terms “outbreak” and
“epidemic” can sometimes be used interchangeably depending on context,
with outbreaks sometimes being considered as localized epidemics.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> What is the outcome of interest? </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>The outcome of interest is typically a measurable quantity derived
from the mathematical model. This could include:</p>
<ul>
<li>The number of infections over time</li>
<li>The peak number of hospitalizations</li>
<li>The total number of severe disease cases</li>
<li>The final size of the epidemic</li>
<li>The timing of epidemic peaks</li>
</ul>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> How is transmission modelled? </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>For example, <a href="reference.html#direct">direct</a> or <a href="reference.html#indirect">indirect</a>, <a href="reference.html#airborne">airborne</a> or <a href="reference.html#vectorborne">vector-borne</a>.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> How are the different processes (e.g. transmission) formulated in the equations? </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>There can be subtle differences in model structures for the same
infection or outbreak type which can be missed without studying the
equations. For example, transmissibility parameters can be specified as
rates or probabilities. If you want to use parameter values from other
published models, you must check that transmission is formulated in the
same way.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Will any interventions be modelled? </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<p>Finally, interventions such as vaccination, social distancing, or
treatment programs may be of interest. Different models have varying
capabilities to incorporate interventions:</p>
<ul>
<li>Some models can simulate continuous interventions (e.g., ongoing
vaccination programs)</li>
<li>Others handle discrete interventions (e.g., one-time school
closures)</li>
<li>Some models may not include intervention capabilities at all</li>
</ul>
<p>We discuss interventions in detail in the tutorial <a href="modelling-interventions.html">Modelling interventions</a>.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="available-models-in-epidemics">Available models in <code>{epidemics}</code>
<a class="anchor" aria-label="anchor" href="#available-models-in-epidemics"></a>
</h2>
<hr class="half-width">
<p>The R package <code>{epidemics}</code> contains functions to run
existing models. For details on the models that are available, see the
package <a href="https://epiverse-trace.github.io/epidemics/reference/index.html#model-functions" class="external-link">Reference
Guide of “Model functions”</a>. All model function names start with
<code>model_*()</code>. To learn how to run the models in R, read the <a href="https://epiverse-trace.github.io/epidemics/articles/#guides-to-library-models" class="external-link">Vignettes
on “Guides to library models”</a>.</p>
<div id="what-model" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="what-model" class="callout-inner">
<h3 class="callout-title">What model?</h3>
<div class="callout-content">
<p>You have been asked to explore the variation in numbers of infectious
individuals in the early stages of an Ebola outbreak.</p>
<p>Which of the following models would be an appropriate choice for this
task:</p>
<ul>
<li><p><code>model_default()</code></p></li>
<li><p><code>model_ebola()</code></p></li>
</ul>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" data-bs-parent="#accordionHint1" aria-labelledby="headingHint1">
<div class="accordion-body">
<p>Consider the following questions:</p>
<div id="checklist1" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Checklist</h3>
<div class="callout-content">
<ul>
<li>What is the infection/disease of interest?</li>
<li>Do we need a deterministic or stochastic model?</li>
<li>What is the outcome of interest?</li>
<li>Will any interventions be modelled?</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7"> Show me the solution </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" data-bs-parent="#accordionSolution7" aria-labelledby="headingSolution7">
<div class="accordion-body">
<ul>
<li>What is the infection/disease of interest?
<strong>Ebola</strong>
</li>
<li>Do we need a deterministic or stochastic model? <strong>A stochastic
model would allow us to explore variation in the early stages of the
outbreak</strong>
</li>
<li>What is the outcome of interest? <strong>Number of
infections</strong>
</li>
<li>Will any interventions be modelled? <strong>No</strong>
</li>
</ul>
<div class="section level4">
<h4 id="model_default">
<code>model_default()</code><a class="anchor" aria-label="anchor" href="#model_default"></a>
</h4>
<p>A deterministic SEIR model with age specific direct transmission.</p>
<figure><img src="fig/model-choices-rendered-diagram-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The model is capable of simulating an Ebola type outbreak, but as the
model is deterministic, we are not able to explore stochastic variation
in the early stages of the outbreak.</p>
</div>
<div class="section level4">
<h4 id="model_ebola">
<code>model_ebola()</code><a class="anchor" aria-label="anchor" href="#model_ebola"></a>
</h4>
<p>A stochastic SEIHFR (Susceptible, Exposed, Infectious, Hospitalised,
Funeral, Removed) model that was developed specifically for Ebola virus
disease. The model includes unique compartments for Hospitalised and
Funeral states, which are critical for understanding Ebola transmission
dynamics due to the high risk of transmission in healthcare settings and
during traditional burial practices. The model has stochasticity in the
passage times between states, which are modelled as Erlang
distributions.</p>
<p>The key parameters affecting the transition between states are:</p>
<ul>
<li>
<span class="math inline">\(R_0\)</span>, the basic reproduction
number,</li>
<li>
<span class="math inline">\(\rho^I\)</span>, the mean infectious
period,</li>
<li>
<span class="math inline">\(\rho^E\)</span>, the mean preinfectious
period,</li>
<li>
<span class="math inline">\(p_{hosp}\)</span> the probability of
being transferred to the hospitalised compartment.</li>
</ul>
<p><strong>Note: the functional relationship between the preinfectious
period (<span class="math inline">\(\rho^E\)</span>) and the transition
rate between exposed and infectious (<span class="math inline">\(\gamma^E\)</span>) is <span class="math inline">\(\rho^E = k^E/\gamma^E\)</span> where <span class="math inline">\(k^E\)</span> is the shape of the Erlang
distribution. Similarly for the infectious period <span class="math inline">\(\rho^I = k^I/\gamma^I\)</span>. For more detail on
the stochastic model formulation refer to the section on <a href="https://epiverse-trace.github.io/epidemics/articles/model_ebola.html#details-discrete-time-ebola-virus-disease-model" class="external-link">Discrete-time
Ebola virus disease model</a> in the “Modelling responses to a
stochastic Ebola virus epidemic” vignette. </strong></p>
<figure><img src="fig/model-choices-rendered-unnamed-chunk-1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The model has additional parameters describing the transmission risk
in hospital and funeral settings:</p>
<ul>
<li>
<span class="math inline">\(p_{ETU}\)</span>, the proportion of
hospitalised cases contributing to the infection of susceptibles (ETU =
Ebola virus treatment units),</li>
<li>
<span class="math inline">\(p_{funeral}\)</span>, the proportion of
funerals at which the risk of transmission is the same as of infectious
individuals in the community.</li>
</ul>
<p>As this model is stochastic, it is the most appropriate choice to
explore how variation in numbers of infected individuals in the early
stages of an Ebola outbreak.</p>
</div>
</div>
</div>
</div>
</div>
<div id="do-i-need-to-use-a-mathematical-model" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="do-i-need-to-use-a-mathematical-model" class="callout-inner">
<h3 class="callout-title">Do I need to use a mathematical model?</h3>
<div class="callout-content">
<p>Mathematical models can be used to generate disease trajectories,
which can then be used to calculate the final size of the epidemic. If
you are only interested in the final size, it is possible to use
mathematical theory to calculate this quantity directly, without having
to simulate the full model then work out how many individuals were
infected. These mathematical calculations are performed using R
functions in the package <a href="https://github.com/epiverse-trace/finalsize" class="external-link">finalsize</a>.</p>
<p>An advantage of using <code>finalsize</code> is that fewer parameters
are required. You only need to define transmissibility and the
susceptibility of the population, and a social contact matrix if
relevant, rather than parameters like infectious period that are
required in {epidemics} to simulate dynamics over time. Check out the <a href="https://epiverse-trace.github.io/finalsize/articles/finalsize.html" class="external-link">package
vignettes</a> for more information on how to use <code>finalsize</code>
to calculate epidemic size.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="challenge-ebola-outbreak-analysis">Challenge : Ebola outbreak analysis<a class="anchor" aria-label="anchor" href="#challenge-ebola-outbreak-analysis"></a>
</h2>
<hr class="half-width">
<div id="running-the-model" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="running-the-model" class="callout-inner">
<h3 class="callout-title">Running the model</h3>
<div class="callout-content">
<p>You have been tasked to generate initial trajectories of an Ebola
outbreak in Guinea. Using <code>model_ebola()</code> and the the
information detailed below, complete the following tasks:</p>
<ol style="list-style-type: decimal">
<li>Run the model once and plot the number of infectious individuals
through time</li>
<li>Run model 100 times and plot the mean, upper and lower 95% quantiles
of the number of infectious individuals through time</li>
</ol>
<ul>
<li>Population size : 14 million</li>
<li>Initial number of exposed individuals : 10</li>
<li>Initial number of infectious individuals : 5</li>
<li>Time of simulation : 120 days</li>
<li>Parameter values :
<ul>
<li>
<span class="math inline">\(R_0\)</span> (<code>r0</code>) =
1.1,</li>
<li>
<span class="math inline">\(p^I\)</span>
(<code>infectious_period</code>) = 12,</li>
<li>
<span class="math inline">\(p^E\)</span>
(<code>preinfectious_period</code>) = 5,</li>
<li>
<span class="math inline">\(k^E=k^I = 2\)</span>,</li>
<li>
<span class="math inline">\(1-p_{hosp}\)</span>
(<code>prop_community</code>) = 0.9,</li>
<li>
<span class="math inline">\(p_{ETU}\)</span> (<code>etu_risk</code>)
= 0.7,</li>
<li>
<span class="math inline">\(p_{funeral}\)</span>
(<code>funeral_risk</code>) = 0.5</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="accordionHint2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint2" aria-expanded="false" aria-controls="collapseHint2">
  <h4 class="accordion-header" id="headingHint2"> Code for initial conditions </h4>
</button>
<div id="collapseHint2" class="accordion-collapse collapse" data-bs-parent="#accordionHint2" aria-labelledby="headingHint2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set population size</span></span>
<span><span class="va">population_size</span> <span class="op">&lt;-</span> <span class="fl">14e6</span></span>
<span></span>
<span><span class="va">E0</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">I0</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="co"># prepare initial conditions as proportions</span></span>
<span><span class="va">initial_conditions</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span></span>
<span>  S <span class="op">=</span> <span class="va">population_size</span> <span class="op">-</span> <span class="op">(</span><span class="va">E0</span> <span class="op">+</span> <span class="va">I0</span><span class="op">)</span>, E <span class="op">=</span> <span class="va">E0</span>, I <span class="op">=</span> <span class="va">I0</span>, H <span class="op">=</span> <span class="fl">0</span>, F <span class="op">=</span> <span class="fl">0</span>, R <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span> <span class="op">/</span> <span class="va">population_size</span></span>
<span></span>
<span><span class="va">guinea_population</span> <span class="op">&lt;-</span> <span class="fu">population</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Guinea"</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="co"># note dummy value</span></span>
<span>  demography_vector <span class="op">=</span> <span class="va">population_size</span>, <span class="co"># 14 million, no age groups</span></span>
<span>  initial_conditions <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span></span>
<span>    <span class="va">initial_conditions</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionHint3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint3" aria-expanded="false" aria-controls="collapseHint3">
  <h4 class="accordion-header" id="headingHint3"> HINT : Multiple model simulations </h4>
</button>
<div id="collapseHint3" class="accordion-collapse collapse" data-bs-parent="#accordionHint3" aria-labelledby="headingHint3">
<div class="accordion-body">
<p>Adapt the code from the <a href="simulating-transmission.html#accounting-for-uncertainty">accounting
for uncertainty</a> section</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8"> Show me the solution </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" data-bs-parent="#accordionSolution8" aria-labelledby="headingSolution8">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>Run the model once and plot the number of infectious individuals
through time</li>
</ol>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model_ebola</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">guinea_population</span>,</span>
<span>  transmission_rate <span class="op">=</span> <span class="fl">1.1</span> <span class="op">/</span> <span class="fl">12</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="fl">2.0</span> <span class="op">/</span> <span class="fl">5</span>,</span>
<span>  removal_rate <span class="op">=</span> <span class="fl">2.0</span> <span class="op">/</span> <span class="fl">12</span>,</span>
<span>  prop_community <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  etu_risk <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  funeral_risk <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  replicates <span class="op">=</span> <span class="fl">1</span> <span class="co"># replicates argument</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">output</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span></span>
<span>    base_size <span class="op">=</span> <span class="fl">15</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/model-choices-rendered-unnamed-chunk-3-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><ol start="2" style="list-style-type: decimal">
<li>Run model 100 times and plot the mean, upper and lower 95% quantiles
of the number of infectious individuals through time</li>
</ol>
<p>We run the model 100 times with the <em>same</em> parameter
values.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_replicates</span> <span class="op">&lt;-</span> <span class="fu">model_ebola</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">guinea_population</span>,</span>
<span>  transmission_rate <span class="op">=</span> <span class="fl">1.1</span> <span class="op">/</span> <span class="fl">12</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="fl">2.0</span> <span class="op">/</span> <span class="fl">5</span>,</span>
<span>  removal_rate <span class="op">=</span> <span class="fl">2.0</span> <span class="op">/</span> <span class="fl">12</span>,</span>
<span>  prop_community <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  etu_risk <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  funeral_risk <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  replicates <span class="op">=</span> <span class="fl">100</span> <span class="co"># replicates argument</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_replicates</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"line"</span>, fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"ribbon"</span>,</span>
<span>    fun.min <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">quantile</span><span class="op">(</span><span class="va">z</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    fun.max <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">quantile</span><span class="op">(</span><span class="va">z</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span></span>
<span>    base_size <span class="op">=</span> <span class="fl">15</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/model-choices-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Existing mathematical models should be selected according to the
research question</li>
<li>It is important to check that a model has appropriate assumptions
about transmission, outbreak potential, outcomes and interventions</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-modelling-interventions"><p>Content from <a href="modelling-interventions.html">Modelling interventions</a></p>
<hr>
<p>Last updated on 2025-05-06 |

        <a href="https://github.com/epiverse-trace/tutorials-late/edit/main/episodes/modelling-interventions.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I investigate the effect of interventions on disease
trajectories?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Add pharmaceutical and non-pharmaceutical interventions to
<code>{epidemics}</code> model</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="prereq1" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Prerequisite</h3>
<div class="callout-content">
<ul>
<li>Complete tutorial on <a href="simulating-transmission.html">Simulating transmission</a>.</li>
</ul>
<p>Learners should also familiarise themselves with following concept
dependencies before working through this tutorial:</p>
<p><strong>Outbreak response</strong> : <a href="https://www.cdc.gov/nonpharmaceutical-interventions/" class="external-link">Intervention
types</a>.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>Mathematical models can be used to generate trajectories of disease
spread under the implementation of interventions at different stages of
an outbreak. These trajectories can be used to make decisions on what
interventions could be implemented to slow down the spread of
diseases.</p>
<p>Interventions are usually incorporated into mathematical models via
manipulating values of relevant parameters, e.g., reduce transmission,
or via introducing a new disease state, e.g., vaccinated class where we
assume that individuals who belong to this class are no longer
susceptible to infection.</p>
<p>In this tutorial, we will learn how to use <code>{epidemics}</code>
to model interventions and access to social contact data with
<a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a>. We’ll use <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>,
<a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a> and the pipe <code>%&gt;%</code> to connect some
of their functions, so let’s also call <a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">epidemics</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">socialmixr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>

</section><section><h2 class="section-heading" id="non-pharmaceutical-interventions">Non-pharmaceutical interventions<a class="anchor" aria-label="anchor" href="#non-pharmaceutical-interventions"></a>
</h2>
<hr class="half-width">
<p><a href="reference.html#NPIs">Non-pharmaceutical interventions</a>
(NPIs) are measures put in place to reduce transmission that do not
include the administration of drugs or vaccinations. NPIs aim at
reducing contacts between infectious and susceptible individuals by
closure of schools and workplaces, and other measures to prevent the
spread of the disease, for example, washing hands and wearing masks.</p>
<p>We will investigate the effect of interventions on a COVID-19
outbreak using an SEIR model (<code>model_default()</code> in the R
package <code>{epidemics}</code>). The SEIR model divides the population
into four compartments: Susceptible (S), Exposed (E), Infectious (I),
and Recovered (R). We will set the following parameters for our model:
<span class="math inline">\(R_0 = 2.7\)</span> (basic reproduction
number), latent period or pre-infectious period <span class="math inline">\(= 4\)</span> days, and the infectious period <span class="math inline">\(= 5.5\)</span> days (parameters adapted from <a href="https://doi.org/10.1016/S2468-2667(20)30133-X" class="external-link">Davies et
al. (2020)</a>). We adopt a contact matrix with age bins 0-18, 18-65, 65
years and older using <a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a>, and assume that one in
every 1 million individuals in each age group is infectious at the start
of the epidemic.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polymod</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="va">polymod</span></span>
<span><span class="va">contact_data</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="fu">contact_matrix</span><span class="op">(</span></span>
<span>  <span class="va">polymod</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"United Kingdom"</span>,</span>
<span>  age.limits <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">15</span>, <span class="fl">65</span><span class="op">)</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare contact matrix</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="fu">t</span><span class="op">(</span><span class="va">contact_data</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare the demography vector</span></span>
<span><span class="va">demography_vector</span> <span class="op">&lt;-</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">population</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">demography_vector</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">rownames</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># initial conditions: one in every 1 million is infected</span></span>
<span><span class="va">initial_i</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span></span>
<span><span class="va">initial_conditions</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span></span>
<span>  S <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">initial_i</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="va">initial_i</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build for all age groups</span></span>
<span><span class="va">initial_conditions</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span></span>
<span>  <span class="fu">rep</span><span class="op">(</span><span class="va">initial_conditions</span>, <span class="fu">dim</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">5</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">rownames</span><span class="op">(</span><span class="va">initial_conditions</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">rownames</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare the population to model as affected by the epidemic</span></span>
<span><span class="va">uk_population</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">population</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"UK"</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector</span>,</span>
<span>  initial_conditions <span class="op">=</span> <span class="va">initial_conditions</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="effect-of-school-closures-on-covid-19-spread">Effect of school closures on COVID-19 spread<a class="anchor" aria-label="anchor" href="#effect-of-school-closures-on-covid-19-spread"></a>
</h4>
<p>The first NPI we will consider is the effect of school closures on
reducing the number of individuals infected with COVID-19 over time. We
assume that a school closure will reduce the frequency of contacts
within and between different age groups. Based on empirical studies, we
assume that school closures will reduce the contacts between school-aged
children (aged 0-15) by 50%, and will cause a small reduction (1%) in
the contacts between adults (aged 15 and over).</p>
<p>To include an intervention in our model we must create an
<code>intervention</code> object. The inputs are the name of the
intervention (<code>name</code>), the type of intervention
(<code>contacts</code> or <code>rate</code>), the start time
(<code>time_begin</code>), the end time (<code>time_end</code>) and the
reduction (<code>reduction</code>). The values of the reduction matrix
are specified in the same order as the age groups in the contact
matrix.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rownames</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "[0,15)"  "[15,65)" "65+"    </code></pre>
</div>
<p>Therefore, we specify
<code>reduction = matrix(c(0.5, 0.01, 0.01))</code>. We assume that the
school closures start on day 50 and continue to be in place for a
further 100 days. Therefore our intervention object is:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">close_schools</span> <span class="op">&lt;-</span> <span class="fu">intervention</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"School closure"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"contacts"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">50</span> <span class="op">+</span> <span class="fl">100</span>,</span>
<span>  reduction <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div id="effect-of-interventions-on-contacts" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="effect-of-interventions-on-contacts" class="callout-inner">
<h3 class="callout-title">Effect of interventions on contacts</h3>
<div class="callout-content">
<p>In <code>{epidemics}</code>, the contact matrix is scaled down by
proportions for the period in which the intervention is in place. To
understand how the reduction is calculated within the model functions,
consider a contact matrix for two age groups with equal number of
contacts:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2]
[1,]    1    1
[2,]    1    1</code></pre>
</div>
<p>If the reduction is 50% in group 1 and 10% in group 2, the contact
matrix during the intervention will be:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2]
[1,] 0.25 0.45
[2,] 0.45 0.81</code></pre>
</div>
<p>The contacts within group 1 are reduced by 50% twice to accommodate
for a 50% reduction in outgoing and incoming contacts (<span class="math inline">\(1\times 0.5 \times 0.5 = 0.25\)</span>).
Similarly, the contacts within group 2 are reduced by 10% twice. The
contacts between group 1 and group 2 are reduced by 50% and then by 10%
(<span class="math inline">\(1 \times 0.5 \times 0.9=
0.45\)</span>).</p>
</div>
</div>
</div>
<p>Using transmission rate <span class="math inline">\(=
2.7/5.5\)</span> (remember that <a href="simulating-transmission.html#the-basic-reproduction-number-r_0">transmission
rate = <span class="math inline">\(R_0\)</span>/ infectious period</a>),
infectiousness rate <span class="math inline">\(1/= 4\)</span> and the
recovery rate <span class="math inline">\(= 1/5.5\)</span> we run the
model with <code>intervention = list(contacts = close_schools)</code> as
follows:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># time periods</span></span>
<span><span class="va">preinfectious_period</span> <span class="op">&lt;-</span> <span class="fl">4.0</span></span>
<span><span class="va">infectious_period</span> <span class="op">&lt;-</span> <span class="fl">5.5</span></span>
<span><span class="va">basic_reproduction</span> <span class="op">&lt;-</span> <span class="fl">2.7</span></span>
<span></span>
<span><span class="co"># rates</span></span>
<span><span class="va">infectiousness_rate</span> <span class="op">&lt;-</span> <span class="fl">1.0</span> <span class="op">/</span> <span class="va">preinfectious_period</span></span>
<span><span class="va">recovery_rate</span> <span class="op">&lt;-</span> <span class="fl">1.0</span> <span class="op">/</span> <span class="va">infectious_period</span></span>
<span><span class="va">transmission_rate</span> <span class="op">&lt;-</span> <span class="va">basic_reproduction</span> <span class="op">/</span> <span class="va">infectious_period</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_school</span> <span class="op">&lt;-</span> <span class="fu">model_default</span><span class="op">(</span></span>
<span>  <span class="co"># population</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  <span class="co"># rate</span></span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  <span class="co"># intervention</span></span>
<span>  intervention <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>contacts <span class="op">=</span> <span class="va">close_schools</span><span class="op">)</span>,</span>
<span>  <span class="co"># time</span></span>
<span>  time_end <span class="op">=</span> <span class="fl">300</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>To be able to see the effect of our intervention, we also run a
baseline variant of the model, i.e, without intervention, combine the
two outputs into one data frame, and then plot the output. Here we plot
the total number of infectious individuals in all age groups using
<code>ggplot2::stat_summary()</code> function:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run baseline simulation with no intervention</span></span>
<span><span class="va">output_baseline</span> <span class="op">&lt;-</span> <span class="fu">model_default</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">300</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create intervention_type column for plotting</span></span>
<span><span class="va">output_school</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"school closure"</span></span>
<span><span class="va">output_baseline</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"baseline"</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">output_school</span>, <span class="va">output_baseline</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">time</span>,</span>
<span>    y <span class="op">=</span> <span class="va">value</span>,</span>
<span>    color <span class="op">=</span> <span class="va">intervention_type</span>,</span>
<span>    linetype <span class="op">=</span> <span class="va">intervention_type</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>      <span class="va">close_schools</span><span class="op">$</span><span class="va">time_begin</span>,</span>
<span>      <span class="va">close_schools</span><span class="op">$</span><span class="va">time_end</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/modelling-interventions-rendered-baseline-1.png" style="display: block; margin: auto;" class="figure">
We can see that with the intervention in place, the infection still
spreads through the population and hence accumulation of immunity
contributes to the eventual peak-and-decline. However, the peak number
of infectious individuals is smaller (green dashed line) than the
baseline with no intervention in place (red solid line), showing a
reduction in the absolute number of cases.</p>
</div>
<div class="section level4">
<h4 id="effect-of-mask-wearing-on-covid-19-spread">Effect of mask wearing on COVID-19 spread<a class="anchor" aria-label="anchor" href="#effect-of-mask-wearing-on-covid-19-spread"></a>
</h4>
<p>We can also model the effect of other NPIs by reducing the value of
the relevant parameters. For example, investigating the effect of mask
wearing on the number of individuals infected with COVID-19 over
time.</p>
<p>We expect that mask wearing will reduce an individual’s
infectiousness, based on multiple studies showing the effectiveness of
masks in reducing transmission. As we are using a population-based
model, we cannot make changes to individual behavior and so assume that
the transmission rate <span class="math inline">\(\beta\)</span> is
reduced by a proportion due to mask wearing in the population. We
specify this proportion, <span class="math inline">\(\theta\)</span> as
product of the proportion wearing masks multiplied by the proportion
reduction in transmission rate (adapted from <a href="https://doi.org/10.1371/journal.pone.0237691" class="external-link">Li et
al. 2020</a>).</p>
<p>We create an intervention object with <code>type = rate</code> and
<code>reduction = 0.161</code>. Using parameters adapted from <a href="https://doi.org/10.1371/journal.pone.0237691" class="external-link">Li et al. 2020</a>
we have proportion wearing masks = coverage <span class="math inline">\(\times\)</span> availability = <span class="math inline">\(0.54 \times 0.525 = 0.2835\)</span> and proportion
reduction in transmission rate = <span class="math inline">\(0.575\)</span>. Therefore, <span class="math inline">\(\theta = 0.2835 \times 0.575 = 0.163\)</span>. We
assume that the mask wearing mandate starts at day 40 and continue to be
in place for 200 days.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mask_mandate</span> <span class="op">&lt;-</span> <span class="fu">intervention</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"mask mandate"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"rate"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">40</span> <span class="op">+</span> <span class="fl">200</span>,</span>
<span>  reduction <span class="op">=</span> <span class="fl">0.163</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>To implement this intervention on the transmission rate <span class="math inline">\(\beta\)</span>, we specify
<code>intervention = list(transmission_rate = mask_mandate)</code>.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_masks</span> <span class="op">&lt;-</span> <span class="fu">model_default</span><span class="op">(</span></span>
<span>  <span class="co"># population</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  <span class="co"># rate</span></span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  <span class="co"># intervention</span></span>
<span>  intervention <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>transmission_rate <span class="op">=</span> <span class="va">mask_mandate</span><span class="op">)</span>,</span>
<span>  <span class="co"># time</span></span>
<span>  time_end <span class="op">=</span> <span class="fl">300</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create intervention_type column for plotting</span></span>
<span><span class="va">output_masks</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"mask mandate"</span></span>
<span><span class="va">output_baseline</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"baseline"</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">output_masks</span>, <span class="va">output_baseline</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">time</span>,</span>
<span>    y <span class="op">=</span> <span class="va">value</span>,</span>
<span>    color <span class="op">=</span> <span class="va">intervention_type</span>,</span>
<span>    linetype <span class="op">=</span> <span class="va">intervention_type</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>      <span class="va">mask_mandate</span><span class="op">$</span><span class="va">time_begin</span>,</span>
<span>      <span class="va">mask_mandate</span><span class="op">$</span><span class="va">time_end</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/modelling-interventions-rendered-plot_masks-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="intervention-types" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="intervention-types" class="callout-inner">
<h3 class="callout-title">Intervention types</h3>
<div class="callout-content">
<p>There are two intervention types for <code>model_default()</code>.
Rate interventions on model parameters (<code>transmission_rate</code>
<span class="math inline">\(\beta\)</span>,
<code>infectiousness_rate</code> <span class="math inline">\(\sigma\)</span> and <code>recovery_rate</code>
<span class="math inline">\(\gamma\)</span>) and contact matrix
reductions (<code>contacts</code>).</p>
<p>To implement both contact and rate interventions in the same
simulation they must be passed as a list, e.g.,
<code>intervention = list(transmission_rate = mask_mandate, contacts = close_schools)</code>.
But if there are multiple interventions that target contact rates, these
must be passed as one <code>contacts</code> input. See the <a href="https://epiverse-trace.github.io/epidemics/articles/modelling_multiple_interventions.html" class="external-link">vignette
on modelling overlapping interventions</a> for more detail.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="pharmaceutical-interventions">Pharmaceutical interventions<a class="anchor" aria-label="anchor" href="#pharmaceutical-interventions"></a>
</h2>
<hr class="half-width">
<p>Pharmaceutical interventions (PIs) are measures such as vaccination
and mass treatment programs. In the previous section, we integrated the
interventions into the model by reducing parameter values during
specific period of time window in which these intervention set to take
place. In the case of vaccination, we assume that after the
intervention, individuals are no longer susceptible and should be
classified into a different disease state. Therefore, we specify the
rate at which individuals are vaccinated and track the number of
vaccinated individuals over time.</p>
<p>The diagram below shows the SEIRV model implemented using
<code>model_default()</code> where susceptible individuals are
vaccinated and then move to the <span class="math inline">\(V\)</span>
class.</p>
<figure><img src="fig/modelling-interventions-rendered-diagram_SEIRV-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The equations describing this model are as follows:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{dS_i}{dt} &amp; = - \beta S_i \sum_j C_{i,j} I_j/N_j -\nu_{t} S_i
\\
\frac{dE_i}{dt} &amp;= \beta S_i\sum_j C_{i,j} I_j/N_j - \alpha E_i \\
\frac{dI_i}{dt} &amp;= \alpha E_i - \gamma I_i \\
\frac{dR_i}{dt} &amp;=\gamma I_i \\
\frac{dV_i}{dt} &amp; =\nu_{i,t} S_i\\
\end{aligned}
\]</span> Individuals in age group (<span class="math inline">\(i\)</span>) at specific time dependent (<span class="math inline">\(t\)</span>) are vaccinated at rate (<span class="math inline">\(\nu_{i,t}\)</span>). The other SEIR components of
these equations are described in the tutorial <a href="simulating-transmission.html#simulating-disease-spread">simulating
transmission</a>.</p>
<p>To explore the effect of vaccination we need to create a vaccination
object to pass as an input into <code>model_default()</code> that
includes age groups specific vaccination rate <code>nu</code> and age
groups specific start and end times of the vaccination program
(<code>time_begin</code> and <code>time_end</code>).</p>
<p>Here we will assume all age groups are vaccinated at the same rate
0.01 and that the vaccination program starts on day 40 and continue to
be in place for 150 days.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare a vaccination object</span></span>
<span><span class="va">vaccinate</span> <span class="op">&lt;-</span> <span class="fu">vaccination</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"vaccinate all"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">40</span>, <span class="fu">nrow</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">40</span> <span class="op">+</span> <span class="fl">150</span>, <span class="fu">nrow</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nu <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>We pass our vaccination object into the model using argument
<code>vaccination = vaccinate</code>:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_vaccinate</span> <span class="op">&lt;-</span> <span class="fu">model_default</span><span class="op">(</span></span>
<span>  <span class="co"># population</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  <span class="co"># rate</span></span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  <span class="co"># intervention</span></span>
<span>  vaccination <span class="op">=</span> <span class="va">vaccinate</span>,</span>
<span>  <span class="co"># time</span></span>
<span>  time_end <span class="op">=</span> <span class="fl">300</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div id="compare-interventions" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="compare-interventions" class="callout-inner">
<h3 class="callout-title">Compare interventions</h3>
<div class="callout-content">
<p>Plot the three interventions vaccination, school closure and mask
mandate and the baseline simulation on one plot. Which intervention
reduces the peak number of infectious individuals the most?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create intervention_type column for plotting</span></span>
<span><span class="va">output_vaccinate</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"vaccination"</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">output_school</span>, <span class="va">output_masks</span>, <span class="va">output_vaccinate</span>, <span class="va">output_baseline</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">time</span>,</span>
<span>    y <span class="op">=</span> <span class="va">value</span>,</span>
<span>    color <span class="op">=</span> <span class="va">intervention_type</span>,</span>
<span>    linetype <span class="op">=</span> <span class="va">intervention_type</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/modelling-interventions-rendered-plot_vaccinate-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>From the plot we see that the peak number of total number of
infectious individuals when vaccination is in place is much lower
compared to school closures and mask wearing interventions.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<p>Different types of intervention can be implemented using mathematical
modelling. Modelling interventions requires assumptions of which model
parameters are affected (e.g. contact matrices, transmission rate), and
by what magnitude and what times in the simulation of an outbreak.</p>
<p>The next step is to quantify the effect of an interventions. If you
are interested in learning how to compare interventions, please complete
the tutorial <a href="compare-interventions.html">Comparing public
health outcomes of interventions</a>.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>The effect of NPIs can be modelled as reducing contact rates between
age groups or reducing the transmission rate of infection</li>
<li>Vaccination can be modelled by assuming individuals move to a
different disease state <span class="math inline">\(V\)</span>
</li>
</ul>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<hr class="half-width">
<ol style="list-style-type: decimal">
<li><p>Davies, N. G., Klepac, P., Liu, Y., Prem, K., Jit, M., &amp;
Eggo, R. M. (2020). Age-dependent effects in the transmission and
control of COVID-19 epidemics. Nature Medicine, 26(8), 1205-1211. <a href="https://doi.org/10.1016/S2468-2667(20)30133-X" class="external-link uri">https://doi.org/10.1016/S2468-2667(20)30133-X</a></p></li>
<li><p>Li, Y., Liang, M., Gao, L., Ahmed, M. A., Uy, J. P., Cheng, C., …
&amp; Sun, C. (2020). Face masks to prevent transmission of COVID-19: A
systematic review and meta-analysis. American Journal of Infection
Control, 49(7), 900-906. <a href="https://doi.org/10.1371/journal.pone.0237691" class="external-link uri">https://doi.org/10.1371/journal.pone.0237691</a></p></li>
<li><p>Mossong, J., Hens, N., Jit, M., Beutels, P., Auranen, K.,
Mikolajczyk, R., … &amp; Edmunds, W. J. (2008). Social contacts and
mixing patterns relevant to the spread of infectious diseases. PLoS
medicine, 5(3), e74. <a href="https://doi.org/10.1371/journal.pmed.0050074" class="external-link uri">https://doi.org/10.1371/journal.pmed.0050074</a></p></li>
</ol>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 --></section></section><section id="aio-compare-interventions"><p>Content from <a href="compare-interventions.html">Comparing public health outcomes of interventions</a></p>
<hr>
<p>Last updated on 2025-05-06 |

        <a href="https://github.com/epiverse-trace/tutorials-late/edit/main/episodes/compare-interventions.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I quantify the effect of an intervention?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Compare intervention scenarios</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="prereq1" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Prerequisite</h3>
<div class="callout-content">
<ul>
<li>Complete tutorials <a href="simulating-transmission.html">Simulating
transmission</a> and <a href="modelling-interventions.html">Modelling
interventions</a>
</li>
</ul>
<p>Learners should familiarise themselves with following concept
dependencies before working through this tutorial:</p>
<p><strong>Outbreak response</strong> : <a href="https://www.cdc.gov/nonpharmaceutical-interventions/" class="external-link">Intervention
types</a>.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>In this tutorial, we will compare intervention scenarios against each
other. To quantify the effect of an intervention, we need to compare our
intervention scenario to a counterfactual (baseline) scenario. The
<em>counterfactual</em> here is the scenario in which nothing changes,
often referred to as the “do-nothing” scenario. The counterfactual
scenario may feature:</p>
<ul>
<li>No interventions at all, or</li>
<li>Existing interventions in place (if we are investigating the
potential impact of an additional intervention)</li>
</ul>
<p>We must also define our <em>outcome of interest</em> to make
comparisons between intervention and counterfactual scenarios. The
outcome of interest can be:</p>
<ul>
<li>Direct model outputs (e.g., number of infections,
hospitalizations)</li>
<li>Epidemiological metrics (e.g., epidemic peak time, final outbreak
size)</li>
<li>Health impact measures (e.g., Quality-Adjusted Life Years [QALYs] or
Disability-Adjusted Life Years [DALYs])</li>
<li>Economic measures (e.g., healthcare costs, productivity losses)</li>
</ul>
<p>In this tutorial, we will learn how to use the R package
<code>{epidemics}</code> to compare the effect of different
interventions on simulated disease trajectories. We will use
<a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a> for social contact data and
<a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a> (including <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>,
<a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>, and the pipe <code>%&gt;%</code>) for data
manipulation and visualization.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">epidemics</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">socialmixr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>

</section><section><h2 class="section-heading" id="visualising-the-effect-of-interventions">Visualising the effect of interventions<a class="anchor" aria-label="anchor" href="#visualising-the-effect-of-interventions"></a>
</h2>
<hr class="half-width">
<p>To compare the baseline scenario against the intervention scenarios,
we can make visualisations of our outcome of interest. The outcome of
interest may simply be the model output, or it could be an aggregate
measure of the model output.</p>
<p>If we wanted to investigate the change in epidemic peak with an
intervention applied, we could plot the model trajectories through
time:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_baseline</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_default</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">300</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_school</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_default</span><span class="op">(</span></span>
<span>  <span class="co"># population</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  <span class="co"># rate</span></span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  <span class="co"># intervention</span></span>
<span>  intervention <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>contacts <span class="op">=</span> <span class="va">close_schools</span><span class="op">)</span>,</span>
<span>  <span class="co"># time</span></span>
<span>  time_end <span class="op">=</span> <span class="fl">300</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create intervention_type column for plotting</span></span>
<span><span class="va">output_school</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"school closure"</span></span>
<span><span class="va">output_baseline</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"baseline"</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">output_school</span>, <span class="va">output_baseline</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">time</span>,</span>
<span>    y <span class="op">=</span> <span class="va">value</span>,</span>
<span>    color <span class="op">=</span> <span class="va">intervention_type</span>,</span>
<span>    linetype <span class="op">=</span> <span class="va">intervention_type</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>      <span class="va">close_schools</span><span class="op">$</span><span class="va">time_begin</span>,</span>
<span>      <span class="va">close_schools</span><span class="op">$</span><span class="va">time_end</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/compare-interventions-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>If we wanted to quantify the impact of the intervention over the
model output through time, we could consider the cumulative number of
infectious people in the baseline scenario compared to the intervention
scenario:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">time</span>, <span class="va">intervention_type</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>value_total <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">intervention_type</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>cum_value <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">value_total</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">time</span>,</span>
<span>      y <span class="op">=</span> <span class="va">cum_value</span>,</span>
<span>      color <span class="op">=</span> <span class="va">intervention_type</span>,</span>
<span>      linetype <span class="op">=</span> <span class="va">intervention_type</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>      <span class="va">close_schools</span><span class="op">$</span><span class="va">time_begin</span>,</span>
<span>      <span class="va">close_schools</span><span class="op">$</span><span class="va">time_end</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Cumulative number of infectious individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'time'. You can override using the
`.groups` argument.</code></pre>
</div>
<figure><img src="fig/compare-interventions-rendered-unnamed-chunk-3-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="section level3">
<h3 id="vacamole-model">Vacamole model<a class="anchor" aria-label="anchor" href="#vacamole-model"></a>
</h3>
<p>The Vacamole model is a deterministic model based on a system of
Ordinary Differential Equations (ODEs) developed by <a href="https://doi.org/10.2807/1560-7917.ES.2022.27.44.2101090" class="external-link">Ainslie
et al. (2022)</a> to describe the effect of vaccination on COVID-19
dynamics. The model consists of 11 compartments, where individuals are
classified as:</p>
<ul>
<li>Susceptible (<span class="math inline">\(S\)</span>)</li>
<li>Partially vaccinated (<span class="math inline">\(V_1\)</span>)</li>
<li>Fully vaccinated (<span class="math inline">\(V_2\)</span>)</li>
<li>Exposed (<span class="math inline">\(E\)</span>) and exposed while
vaccinated (<span class="math inline">\(E_V\)</span>)</li>
<li>Infectious (<span class="math inline">\(I\)</span>) and infectious
while vaccinated (<span class="math inline">\(I_V\)</span>)</li>
<li>Hospitalized (<span class="math inline">\(H\)</span>) and
hospitalized while vaccinated (<span class="math inline">\(H_V\)</span>)</li>
<li>Dead (<span class="math inline">\(D\)</span>)</li>
<li>Recovered (<span class="math inline">\(R\)</span>)</li>
</ul>
<p>The diagram below describes the flow of individuals through the
different compartments.</p>
<figure><img src="fig/compare-interventions-rendered-unnamed-chunk-4-1.png" width="80%" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="running-a-counterfactual-scenario-using-the-vacamole-model" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="running-a-counterfactual-scenario-using-the-vacamole-model" class="callout-inner">
<h3 class="callout-title">Running a counterfactual scenario using the Vacamole model</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Run the model with the default parameter values for the UK
population assuming that:</li>
</ol>
<ul>
<li>One in every million individuals (0.0001%) is infectious (and not
vaccinated) at the start of the simulation</li>
<li>The contact matrix for the United Kingdom has the following age
bins:
<ul>
<li>0-20 years</li>
<li>20-40 years</li>
<li>40+ years</li>
</ul>
</li>
</ul>
<p>For the following scenarios:</p>
<ul>
<li>Baseline: Two-dose vaccination program
<ul>
<li>Dose 1 (vaccination rate 0.01) starts from day 30</li>
<li>Dose 2 (vaccination rate 0.01) starts from day 60</li>
<li>Both programs run for 300 days</li>
</ul>
</li>
<li>Intervention: Mask mandate
<ul>
<li>Starts from day 60</li>
<li>Lasts for 100 days</li>
<li>Reduces transmission rate by 16.3% (based on empirical studies of
mask effectiveness)</li>
</ul>
</li>
</ul>
<p>There is no vaccination scheme in place</p>
<ol start="2" style="list-style-type: decimal">
<li>Using the output, plot the cumulative number of deaths through
time</li>
</ol>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> HINT : Running the model with default parameter values </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" data-bs-parent="#accordionHint1" aria-labelledby="headingHint1">
<div class="accordion-body">
<p>We can run the Vacamole model with <a href="https://epiverse-trace.github.io/epidemics/articles/model_vacamole.html#model-epidemic-using-vacamole" class="external-link">default
parameter values</a> by just specifying the population object and number
of time steps to run the model for:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_vacamole</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">300</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>Run the model</li>
</ol>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polymod</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="va">polymod</span></span>
<span><span class="va">contact_data</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="fu">contact_matrix</span><span class="op">(</span></span>
<span>  survey <span class="op">=</span> <span class="va">polymod</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"United Kingdom"</span>,</span>
<span>  age.limits <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare contact matrix</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="fu">t</span><span class="op">(</span><span class="va">contact_data</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract demography vector</span></span>
<span><span class="va">demography_vector</span> <span class="op">&lt;-</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">population</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">demography_vector</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">rownames</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare initial conditions</span></span>
<span><span class="va">initial_i</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span></span>
<span></span>
<span><span class="va">initial_conditions_vacamole</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span></span>
<span>  S <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">initial_i</span>,</span>
<span>  V1 <span class="op">=</span> <span class="fl">0</span>, V2 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  E <span class="op">=</span> <span class="fl">0</span>, EV <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  I <span class="op">=</span> <span class="va">initial_i</span>, IV <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  H <span class="op">=</span> <span class="fl">0</span>, HV <span class="op">=</span> <span class="fl">0</span>, D <span class="op">=</span> <span class="fl">0</span>, R <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">initial_conditions_vacamole</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span></span>
<span>  <span class="va">initial_conditions_vacamole</span>,</span>
<span>  <span class="va">initial_conditions_vacamole</span>,</span>
<span>  <span class="va">initial_conditions_vacamole</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">rownames</span><span class="op">(</span><span class="va">initial_conditions_vacamole</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">rownames</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare population object</span></span>
<span><span class="va">uk_population_vacamole</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">population</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"UK"</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector</span>,</span>
<span>  initial_conditions <span class="op">=</span> <span class="va">initial_conditions_vacamole</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare two vaccination objects</span></span>
<span><span class="co"># dose 1 vaccination</span></span>
<span><span class="va">dose_1</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">vaccination</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"two-dose vaccination"</span>, <span class="co"># name given to first dose</span></span>
<span>  nu <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">0.01</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">30</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">300</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare the second dose with a 30 day interval in start date</span></span>
<span><span class="va">dose_2</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">vaccination</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"two-dose vaccination"</span>, <span class="co"># name given to first dose</span></span>
<span>  nu <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">0.01</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">30</span> <span class="op">+</span> <span class="fl">30</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">300</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use `c()` to combine the two doses</span></span>
<span><span class="va">double_vaccination</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">dose_1</span>, <span class="va">dose_2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run baseline model</span></span>
<span><span class="va">output_baseline_vc</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_vacamole</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population_vacamole</span>,</span>
<span>  vaccination <span class="op">=</span> <span class="va">double_vaccination</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">300</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create mask intervention</span></span>
<span><span class="va">mask_mandate</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">intervention</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"mask mandate"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"rate"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fl">60</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">60</span> <span class="op">+</span> <span class="fl">100</span>,</span>
<span>  reduction <span class="op">=</span> <span class="fl">0.163</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run intervention model</span></span>
<span><span class="va">output_intervention_vc</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_vacamole</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population_vacamole</span>,</span>
<span>  vaccination <span class="op">=</span> <span class="va">double_vaccination</span>,</span>
<span>  intervention <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>    transmission_rate <span class="op">=</span> <span class="va">mask_mandate</span></span>
<span>  <span class="op">)</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">300</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Plot the cumulative number of deaths through time</li>
</ol>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create intervention_type column for plotting</span></span>
<span><span class="va">output_intervention_vc</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"mask mandate"</span></span>
<span><span class="va">output_baseline_vc</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"baseline"</span></span>
<span><span class="va">output_vacamole</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">output_intervention_vc</span>, <span class="va">output_baseline_vc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_vacamole</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"dead"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">time</span>, <span class="va">intervention_type</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>value_total <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">intervention_type</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>cum_value <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">value_total</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">time</span>,</span>
<span>      y <span class="op">=</span> <span class="va">cum_value</span>,</span>
<span>      color <span class="op">=</span> <span class="va">intervention_type</span>,</span>
<span>      linetype <span class="op">=</span> <span class="va">intervention_type</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Cumulative number of deaths"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'time'. You can override using the
`.groups` argument.</code></pre>
</div>
<figure><img src="fig/compare-interventions-rendered-unnamed-chunk-7-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="calculating-outcomes-averted">Calculating outcomes averted<a class="anchor" aria-label="anchor" href="#calculating-outcomes-averted"></a>
</h2>
<hr class="half-width">
<p>While visualizations are useful for comparing intervention scenarios
over time, we also need quantitative measures of intervention impact.
One such measure is the number of infections averted, which helps us
understand the difference between intervention scenarios.</p>
<p>The R package <code>{epidemics}</code> provides the
<code>outcomes_averted()</code> function to calculate infections averted
while accounting for parameter uncertainty. Let’s extend our COVID-19
example from <a href="modelling-interventions.html">Modelling
interventions</a> to account for uncertainty in the basic reproduction
number (<span class="math inline">\(R_0\)</span>).</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># time periods</span></span>
<span><span class="va">preinfectious_period</span> <span class="op">&lt;-</span> <span class="fl">4.0</span></span>
<span><span class="va">infectious_period</span> <span class="op">&lt;-</span> <span class="fl">5.5</span></span>
<span></span>
<span><span class="co"># specify the mean and standard deviation of R0</span></span>
<span><span class="va">r_estimate_mean</span> <span class="op">&lt;-</span> <span class="fl">2.7</span></span>
<span><span class="va">r_estimate_sd</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span></span>
<span><span class="co"># generate 100 R samples</span></span>
<span><span class="va">r_samples</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu">with_seed</span><span class="op">(</span></span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="fu">rnorm</span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fl">100</span>, mean <span class="op">=</span> <span class="va">r_estimate_mean</span>, sd <span class="op">=</span> <span class="va">r_estimate_sd</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="va">r_samples</span> <span class="op">/</span> <span class="va">infectious_period</span></span>
<span></span>
<span><span class="co"># rates</span></span>
<span><span class="va">infectiousness_rate</span> <span class="op">&lt;-</span> <span class="fl">1.0</span> <span class="op">/</span> <span class="va">preinfectious_period</span></span>
<span><span class="va">recovery_rate</span> <span class="op">&lt;-</span> <span class="fl">1.0</span> <span class="op">/</span> <span class="va">infectious_period</span></span></code></pre>
</div>
<p>We use these parameter values alongside the population structure and
contact matrix used in <a href="modelling-interventions.html">Modelling
interventions</a> to run the model for the baseline scenario:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_baseline</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_default</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  transmission_rate <span class="op">=</span> <span class="va">beta</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">300</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Then, we create a list of all the interventions we want to include in
our comparison. We define our scenarios as follows:</p>
<ul>
<li>scenario 1 : close schools</li>
<li>scenario 2 : mask mandate</li>
<li>scenario 3 : close schools and mask mandate.</li>
</ul>
<p>In R we specify this as:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">intervention_scenarios</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span></span>
<span>  scenario_1 <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>    contacts <span class="op">=</span> <span class="va">close_schools</span></span>
<span>  <span class="op">)</span>,</span>
<span>  scenario_2 <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>    transmission_rate <span class="op">=</span> <span class="va">mask_mandate</span></span>
<span>  <span class="op">)</span>,</span>
<span>  scenario_3 <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>    contacts <span class="op">=</span> <span class="va">close_schools</span>,</span>
<span>    transmission_rate <span class="op">=</span> <span class="va">mask_mandate</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>We use this list as our input to <code>intervention</code> in
<code>model_default</code></p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_default</span><span class="op">(</span></span>
<span>  <span class="va">uk_population</span>,</span>
<span>  transmission_rate <span class="op">=</span> <span class="va">beta</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">300</span>, increment <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>  intervention <span class="op">=</span> <span class="va">intervention_scenarios</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   transmission_rate infectiousness_rate recovery_rate time_end param_set
               &lt;num&gt;               &lt;num&gt;         &lt;num&gt;    &lt;num&gt;     &lt;int&gt;
1:         0.4852141                0.25     0.1818182      300         1
2:         0.4852141                0.25     0.1818182      300         1
3:         0.4852141                0.25     0.1818182      300         1
4:         0.4925786                0.25     0.1818182      300         2
5:         0.4925786                0.25     0.1818182      300         2
6:         0.4925786                0.25     0.1818182      300         2
        population intervention vaccination time_dependence increment scenario
            &lt;list&gt;       &lt;list&gt;      &lt;list&gt;          &lt;list&gt;     &lt;num&gt;    &lt;int&gt;
1: &lt;population[4]&gt;    &lt;list[1]&gt;      [NULL]       &lt;list[1]&gt;         1        1
2: &lt;population[4]&gt;    &lt;list[1]&gt;      [NULL]       &lt;list[1]&gt;         1        2
3: &lt;population[4]&gt;    &lt;list[2]&gt;      [NULL]       &lt;list[1]&gt;         1        3
4: &lt;population[4]&gt;    &lt;list[1]&gt;      [NULL]       &lt;list[1]&gt;         1        1
5: &lt;population[4]&gt;    &lt;list[1]&gt;      [NULL]       &lt;list[1]&gt;         1        2
6: &lt;population[4]&gt;    &lt;list[2]&gt;      [NULL]       &lt;list[1]&gt;         1        3
                   data
                 &lt;list&gt;
1: &lt;data.table[4515x4]&gt;
2: &lt;data.table[4515x4]&gt;
3: &lt;data.table[4515x4]&gt;
4: &lt;data.table[4515x4]&gt;
5: &lt;data.table[4515x4]&gt;
6: &lt;data.table[4515x4]&gt;</code></pre>
</div>
<p>Now that we have our model output for all of our scenarios, we want
to compare the outputs of the interventions to our baseline.</p>
<p>We can do this using <code>outcomes_averted()</code> in
<code>{epidemics}</code>. This function calculates the final epidemic
size for each scenario, and then calculates the number of infections
averted in each scenario compared to the baseline. To use this function
we specify the :</p>
<ul>
<li>output of the baseline scenario</li>
<li>outputs of the intervention scenario(s).</li>
</ul>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">intervention_effect</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">outcomes_averted</span><span class="op">(</span></span>
<span>  baseline <span class="op">=</span> <span class="va">output_baseline</span>, scenarios <span class="op">=</span> <span class="va">output</span></span>
<span><span class="op">)</span></span>
<span><span class="va">intervention_effect</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   scenario demography_group averted_median averted_lower averted_upper
      &lt;int&gt;           &lt;char&gt;          &lt;num&gt;         &lt;num&gt;         &lt;num&gt;
1:        1              65+       406460.4      384173.6      414531.2
2:        1           [0,15)      2897767.0     2585433.4     3087910.3
3:        1          [15,65)      1290610.3     1260167.1     1293085.1
4:        2              65+       901095.6      882456.9      913201.0
5:        2           [0,15)       517908.2      478559.2      558887.4
6:        2          [15,65)      2414212.2     2260224.7     2567231.2
7:        3              65+      1004856.8      865428.3     1100732.4
8:        3           [0,15)      1977460.8     1496867.6     2418130.3
9:        3          [15,65)      2910649.5     2548675.5     3131795.3</code></pre>
</div>
<p>The output gives us the infections averted in each scenario compared
to the baseline. To obtain the infections averted overall we specify
<code>by_group = FALSE</code>:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">intervention_effect</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">outcomes_averted</span><span class="op">(</span></span>
<span>  baseline <span class="op">=</span> <span class="va">output_baseline</span>, scenarios <span class="op">=</span> <span class="va">output</span>,</span>
<span>  by_group <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">intervention_effect</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   scenario averted_median averted_lower averted_upper
      &lt;int&gt;          &lt;num&gt;         &lt;num&gt;         &lt;num&gt;
1:        1        4597247       4232474       4778382
2:        2        3833216       3621241       4039320
3:        3        5892967       4910971       6650658</code></pre>
</div>
<div id="package-vignettes" class="callout testimonial">
<div class="callout-square">
<i class="callout-icon" data-feather="heart"></i>
</div>
<div id="package-vignettes" class="callout-inner">
<h3 class="callout-title">Package vignettes</h3>
<div class="callout-content">
<p>We recommend to read the vignette on <a href="https://epiverse-trace.github.io/epidemics/articles/model_ebola.html" class="external-link">Modelling
responses to a stochastic Ebola virus epidemic</a> to use a discrete
time, stochastic compartmental model of Ebola used during the 2014 West
African EVD outbreak.</p>
</div>
</div>
</div>
<div id="challenge-ebola-outbreak-analysis" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-ebola-outbreak-analysis" class="callout-inner">
<h3 class="callout-title">Challenge : Ebola outbreak analysis</h3>
<div class="callout-content">
<p>You have been tasked to investigate the potential impact of an
intervention on an Ebola outbreak in Guinea (e.g. a reduction in risky
contacts with cases). Using <code>model_ebola()</code> and the the
information detailed below, find the number of infections averted when
:</p>
<ul>
<li>an intervention is applied to reduce the transmission rate by 50%
from day 60 and,</li>
<li>an intervention is applied to reduce transmission by 10% from day
30.</li>
</ul>
<p>For both interventions, we assume there is some uncertainty about the
baseline transmission rate. We capture this uncertainty by drawing from
a normal distribution with mean = 1.1 / 12 (i.e. <span class="math inline">\(R_0=1.1\)</span> and infectious period = 12 days)
and standard deviation = 0.01.</p>
<p><em>Note: Depending on the number of replicates used, this simulation
may take several minutes to run.</em></p>
<ul>
<li>Population size : 14 million</li>
<li>Initial number of exposed individuals : 10</li>
<li>Initial number of infectious individuals : 5</li>
<li>Time of simulation : 120 days</li>
<li>Parameter values :
<ul>
<li>
<span class="math inline">\(R_0\)</span> (<code>r0</code>) =
1.1,</li>
<li>
<span class="math inline">\(p^I\)</span>
(<code>infectious_period</code>) = 12,</li>
<li>
<span class="math inline">\(p^E\)</span>
(<code>preinfectious_period</code>) = 5,</li>
<li>
<span class="math inline">\(k^E=k^I = 2\)</span>,</li>
<li>
<span class="math inline">\(1-p_{hosp}\)</span>
(<code>prop_community</code>) = 0.9,</li>
<li>
<span class="math inline">\(p_{ETU}\)</span> (<code>etu_risk</code>)
= 0.7,</li>
<li>
<span class="math inline">\(p_{funeral}\)</span>
(<code>funeral_risk</code>) = 0.5</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">population_size</span> <span class="op">&lt;-</span> <span class="fl">14e6</span></span>
<span></span>
<span><span class="va">E0</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">I0</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="co"># prepare initial conditions as proportions</span></span>
<span><span class="va">initial_conditions</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span></span>
<span>  S <span class="op">=</span> <span class="va">population_size</span> <span class="op">-</span> <span class="op">(</span><span class="va">E0</span> <span class="op">+</span> <span class="va">I0</span><span class="op">)</span>, E <span class="op">=</span> <span class="va">E0</span>, I <span class="op">=</span> <span class="va">I0</span>, H <span class="op">=</span> <span class="fl">0</span>, F <span class="op">=</span> <span class="fl">0</span>, R <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span> <span class="op">/</span> <span class="va">population_size</span></span>
<span></span>
<span><span class="co"># set up population object</span></span>
<span><span class="va">guinea_population</span> <span class="op">&lt;-</span> <span class="fu">population</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Guinea"</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="co"># note dummy value</span></span>
<span>  demography_vector <span class="op">=</span> <span class="va">population_size</span>, <span class="co"># 14 million, no age groups</span></span>
<span>  initial_conditions <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span></span>
<span>    <span class="va">initial_conditions</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate 100 beta samples</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu">with_seed</span><span class="op">(</span></span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="fu">rnorm</span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fl">100</span>, mean <span class="op">=</span> <span class="fl">1.1</span> <span class="op">/</span> <span class="fl">12</span>, sd <span class="op">=</span> <span class="fl">0.01</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run the baseline</span></span>
<span><span class="va">output_baseline</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_ebola</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">guinea_population</span>,</span>
<span>  transmission_rate <span class="op">=</span> <span class="va">beta</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="fl">2.0</span> <span class="op">/</span> <span class="fl">5</span>,</span>
<span>  removal_rate <span class="op">=</span> <span class="fl">2.0</span> <span class="op">/</span> <span class="fl">12</span>,</span>
<span>  prop_community <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  etu_risk <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  funeral_risk <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  replicates <span class="op">=</span> <span class="fl">100</span> <span class="co"># replicates argument</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create intervention objects</span></span>
<span><span class="va">reduce_transmission_1</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">intervention</span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"rate"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fl">60</span>, time_end <span class="op">=</span> <span class="fl">100</span>, reduction <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">reduce_transmission_2</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">intervention</span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"rate"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fl">30</span>, time_end <span class="op">=</span> <span class="fl">100</span>, reduction <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create intervention list</span></span>
<span><span class="va">intervention_scenarios</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span></span>
<span>  scenario_1 <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>    transmission_rate <span class="op">=</span> <span class="va">reduce_transmission_1</span></span>
<span>  <span class="op">)</span>,</span>
<span>  scenario_2 <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>    transmission_rate <span class="op">=</span> <span class="va">reduce_transmission_2</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run model</span></span>
<span><span class="va">output_intervention</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_ebola</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">guinea_population</span>,</span>
<span>  transmission_rate <span class="op">=</span> <span class="va">beta</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="fl">2.0</span> <span class="op">/</span> <span class="fl">5</span>,</span>
<span>  removal_rate <span class="op">=</span> <span class="fl">2.0</span> <span class="op">/</span> <span class="fl">12</span>,</span>
<span>  prop_community <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  etu_risk <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  funeral_risk <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  replicates <span class="op">=</span> <span class="fl">100</span>, <span class="co"># replicates argument,</span></span>
<span>  intervention <span class="op">=</span> <span class="va">intervention_scenarios</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Running 2 scenarios and 100 parameter sets with 100 replicates each, for a
total of 20000 model runs.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate outcomes averted</span></span>
<span><span class="va">intervention_effect</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">outcomes_averted</span><span class="op">(</span></span>
<span>  baseline <span class="op">=</span> <span class="va">output_baseline</span>, scenarios <span class="op">=</span> <span class="va">output_intervention</span>,</span>
<span>  by_group <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">intervention_effect</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   scenario averted_median averted_lower averted_upper
      &lt;int&gt;          &lt;num&gt;         &lt;num&gt;         &lt;num&gt;
1:        1             31             1           112
2:        2             20           -22           105</code></pre>
</div>
<p><strong>Note: The number of infections averted can be negative. This
is due to the stochastic variation in the disease trajectories for a
given transmission rate can result in a different size
outbreak.</strong></p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>A counterfactual (baseline) scenario must be clearly defined for
meaningful comparisons</li>
<li>Scenarios can be compared using both visualizations and quantitative
measures</li>
<li>The outcomes_averted() function helps quantify intervention
effects</li>
<li>Parameter uncertainty should be considered in intervention
analysis</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-vaccine-comparisons"><p>Content from <a href="vaccine-comparisons.html">Comparing vaccination strategies</a></p>
<hr>
<p>Last updated on 2025-05-06 |

        <a href="https://github.com/epiverse-trace/tutorials-late/edit/main/episodes/vaccine-comparisons.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are the direct and indirect effects of vaccination?</li>
<li>What are the benefits of targeted vaccination programs?</li>
<li>What happens if we combine vaccination and NPIs?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the potential impact of vaccination programs</li>
<li>Implement vaccination programs and NPI measures simultaneously using
<code>{epidemics}</code>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="prereq1" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Prerequisite</h3>
<div class="callout-content">
<ul>
<li>Complete tutorials <a href="simulating-transmission.html">Simulating
transmission</a>, <a href="modelling-interventions.html">Modelling
interventions</a> and <a href="compare-interventions.html">Comparing
public health outcomes of interventions</a>.</li>
</ul>
<p>Learners should familiarise themselves with following concept
dependencies before working through this tutorial:</p>
<p><strong>Outbreak response</strong> : <a href="https://www.cdc.gov/nonpharmaceutical-interventions/" class="external-link">Intervention
types</a>.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>Vaccine programs can be used to help control epidemics via direct and
indirect protection from infection. We can use mathematical models to
make predictions about the potential impact of different vaccination
strategies.</p>
<p>Depending on how infections spread, targeting specific risk groups
for vaccination may be a more effective strategy than vaccinating
everyone. When vaccine programs are not immediately available to be
rolled out, either from a capacity or development perspective, we may
also want to know how non-pharmaceutical interventions (NPIs) can be
used to control the epidemic in the meantime, as well as after a vaccine
program has started.</p>
<p>In this tutorial we will compare different vaccination strategies
using models from <code>{epidemics}</code>. We will use the following R
packages:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">epidemics</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">purrr</span><span class="op">)</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="key-terms">Key Terms<a class="anchor" aria-label="anchor" href="#key-terms"></a>
</h2>
<hr class="half-width">
<p>Before proceeding, let’s define some important terms:</p>
<ul>
<li>
<strong>Herd immunity</strong>: A form of indirect protection from
infectious disease that occurs when a sufficient proportion of a
population has become immune to an infection, thereby reducing the
likelihood of infection for individuals who lack immunity.</li>
<li>
<strong>Vaccination strategies</strong>: Different approaches to
administering vaccines, which may include targeting specific age groups
or risk populations.</li>
<li>
<strong>Non-pharmaceutical interventions (NPIs)</strong>: Actions,
apart from vaccines and treaments, that people and communities can take
to help slow the spread of illnesses.</li>
</ul></section><section><h2 class="section-heading" id="direct-and-indirect-effects-of-vaccination">Direct and indirect effects of vaccination<a class="anchor" aria-label="anchor" href="#direct-and-indirect-effects-of-vaccination"></a>
</h2>
<hr class="half-width">
<p>Vaccination programs using infection-blocking vaccines have two
benefits:</p>
<ol style="list-style-type: decimal">
<li>Reducing individual risk of infection (<strong>direct</strong>
effect of vaccination)</li>
<li>Reducing onward contribution to transmission
(<strong>indirect</strong> effect of vaccination).</li>
</ol>
<p>We will illustrate this using results from
<code>model_default()</code> in <code>{epidemics}</code>. The
<code>model_default()</code> function implements a standard SEIR
(Susceptible-Exposed-Infected-Recovered) model with vaccination
compartments. Using the contact matrix and parameters from the COVID-19
outbreak example in <a href="modelling-interventions.html">Modelling
interventions</a> we will investigate the impact of two vaccination
programs on the number of infections. For this hypothetical scenario, we
will assume that vaccination programs start on day 0 and continue to be
in place for 150 days. We will assume all age groups are vaccinated at
the same rate in each program as follows:</p>
<ul>
<li>vaccination program 01: vaccination rate 0.001</li>
<li>vaccination program 02: vaccination rate 0.01.</li>
</ul>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare vaccination objects</span></span>
<span><span class="va">vaccinate_01</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">vaccination</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"vaccinate all"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">0</span>, <span class="fu">nrow</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">150</span>, <span class="fu">nrow</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nu <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">vaccinate_02</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">vaccination</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"vaccinate all"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">0</span>, <span class="fu">nrow</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">150</span>, <span class="fu">nrow</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nu <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>We see the intuitive result that the higher the vaccination rate, the
more people that are vaccinated.</p>
<div class="tabs">
<nav><div id="nav-tab-1" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-1-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-1" type="button" role="tab" aria-controls="nav-tabpanel-1-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-1-1">
  Output
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-2" type="button" role="tab" aria-controls="nav-tabpanel-1-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-2">
  R Code
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-1" class="tab-content">
<div id="nav-tabpanel-1-1" class="tab-pane show active" role="tabpanel" aria-labelledby="nav-tab-1-1">
<figure><img src="fig/vaccine-comparisons-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-1-2" class="tab-pane" role="tabpanel" aria-labelledby="nav-tab-1-2">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_baseline</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_default</span><span class="op">(</span></span>
<span>  <span class="co"># population</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  <span class="co"># rate</span></span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  <span class="co"># time</span></span>
<span>  time_end <span class="op">=</span> <span class="fl">200</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_vaccinate_01</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_default</span><span class="op">(</span></span>
<span>  <span class="co"># population</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  <span class="co"># rate</span></span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  <span class="co"># intervention</span></span>
<span>  vaccination <span class="op">=</span> <span class="va">vaccinate_01</span>,</span>
<span>  <span class="co"># time</span></span>
<span>  time_end <span class="op">=</span> <span class="fl">200</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_vaccinate_02</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_default</span><span class="op">(</span></span>
<span>  <span class="co"># population</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  <span class="co"># rate</span></span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  <span class="co"># intervention</span></span>
<span>  vaccination <span class="op">=</span> <span class="va">vaccinate_02</span>,</span>
<span>  <span class="co"># time</span></span>
<span>  time_end <span class="op">=</span> <span class="fl">200</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create intervention_type column for plotting</span></span>
<span><span class="va">output_baseline</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"baseline"</span></span>
<span><span class="va">output_vaccinate_01</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"vaccinate 0.001"</span></span>
<span><span class="va">output_vaccinate_02</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"vaccinate 0.01"</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">output_baseline</span>, <span class="va">output_vaccinate_01</span>, <span class="va">output_vaccinate_02</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">output</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"vaccinated"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Number vaccinated"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">time</span>,</span>
<span>    y <span class="op">=</span> <span class="va">value</span>,</span>
<span>    color <span class="op">=</span> <span class="va">intervention_type</span>,</span>
<span>    linetype <span class="op">=</span> <span class="va">intervention_type</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>      <span class="va">vaccinate_01</span><span class="op">$</span><span class="va">time_begin</span>,</span>
<span>      <span class="va">vaccinate_01</span><span class="op">$</span><span class="va">time_end</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>To understand the <strong>indirect</strong> effect of vaccinations,
we want to know the effect that vaccination has on transmission, and
hence the rate at new infections occur. We will use the function
<code>new_infections()</code> in <code>{epidemics}</code> to calculate
the number of new infections over time for the different vaccination
programs.</p>
<p>The inputs required are :</p>
<ul>
<li>
<code>data</code> : the model output,</li>
<li>
<code>compartments_from_susceptible</code> : this is an optional
input, but in our case needed. We don’t want the number of people
vaccinated to be counted as new infections, so we need to specify the
name of the model compartment where individuals transition out from
<code>susceptible</code> (in this example <code>vaccinated</code>),</li>
<li>
<code>by_group</code> : should the results be calculated for each
demographic group separately.</li>
</ul>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vaccinate_01_infections</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">new_infections</span><span class="op">(</span></span>
<span>  <span class="va">output_vaccinate_01</span>,</span>
<span>  compartments_from_susceptible <span class="op">=</span> <span class="st">"vaccinated"</span>,</span>
<span>  by_group <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="tabs">
<nav><div id="nav-tab-2" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-2-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-1" type="button" role="tab" aria-controls="nav-tabpanel-2-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-2-1">
  Output
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-2" type="button" role="tab" aria-controls="nav-tabpanel-2-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-2">
  R code
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-2" class="tab-content">
<div id="nav-tabpanel-2-1" class="tab-pane show active" role="tabpanel" aria-labelledby="nav-tab-2-1">
<figure><img src="fig/vaccine-comparisons-rendered-unnamed-chunk-7-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-2-2" class="tab-pane" role="tabpanel" aria-labelledby="nav-tab-2-2">
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate new infections</span></span>
<span><span class="va">baseline_infections</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">new_infections</span><span class="op">(</span></span>
<span>  <span class="va">output_baseline</span>,</span>
<span>  compartments_from_susceptible <span class="op">=</span> <span class="st">"vaccinated"</span>,</span>
<span>  by_group <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">vaccinate_01_infections</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">new_infections</span><span class="op">(</span></span>
<span>  <span class="va">output_vaccinate_01</span>,</span>
<span>  compartments_from_susceptible <span class="op">=</span> <span class="st">"vaccinated"</span>,</span>
<span>  by_group <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">vaccinate_02_infections</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">new_infections</span><span class="op">(</span></span>
<span>  <span class="va">output_vaccinate_02</span>,</span>
<span>  compartments_from_susceptible <span class="op">=</span> <span class="st">"vaccinated"</span>,</span>
<span>  by_group <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create intervention_type column for plotting</span></span>
<span><span class="va">baseline_infections</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"baseline"</span></span>
<span><span class="va">vaccinate_01_infections</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"vaccinate 0.001"</span></span>
<span><span class="va">vaccinate_02_infections</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"vaccinate 0.01"</span></span>
<span><span class="va">infections</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span></span>
<span>  <span class="va">baseline_infections</span>,</span>
<span>  <span class="va">vaccinate_01_infections</span>,</span>
<span>  <span class="va">vaccinate_02_infections</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">infections</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"New infections"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span></span>
<span>      <span class="va">time</span>,</span>
<span>      <span class="va">new_infections</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">intervention_type</span>,</span>
<span>      linetype <span class="op">=</span> <span class="va">intervention_type</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>      <span class="va">vaccinate_01</span><span class="op">$</span><span class="va">time_begin</span>,</span>
<span>      <span class="va">vaccinate_01</span><span class="op">$</span><span class="va">time_end</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>We see that after accounting for the number of people vaccinated,
there are fewer new infections when you have a higher vaccination rate.
This is because there are fewer people susceptible to infection, and
therefore fewer people who can become infected and contribute to onward
infection.</p>
<p>This <strong>indirect</strong> effect of vaccination programs is key
to successfully controlling and eradicating infections.</p>
<p>To evaluate the impact of vaccination programs, we often consider
both the peak size, which indicates healthcare pressure at a single
point in time, and the overall epidemic size, which refers to the
cumulative number of infections.</p>
<p>We can find the cumulative sum using the R function
<code>cumsum()</code> and use <code>purrr::map_dfr()</code> to loop over
a list of new infection data frames. We can see the difference in
infection numbers is by several orders of magnitude.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create function that returns the intervention type and cumulative sum for</span></span>
<span><span class="co"># given infections</span></span>
<span><span class="va">find_cumsum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">infections</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="fu">data.frame</span><span class="op">(</span></span>
<span>    intervention_type <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">infections</span><span class="op">$</span><span class="va">intervention_type</span><span class="op">)</span>,</span>
<span>    cumulative_sum <span class="op">=</span> <span class="fu">tail</span><span class="op">(</span><span class="fu">cumsum</span><span class="op">(</span><span class="va">infections</span><span class="op">$</span><span class="va">new_infections</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># create list of interventions</span></span>
<span><span class="va">interventions</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu">lst</span><span class="op">(</span></span>
<span>  <span class="va">baseline_infections</span>,</span>
<span>  <span class="va">vaccinate_01_infections</span>,</span>
<span>  <span class="va">vaccinate_02_infections</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># apply function to each data frame in the list</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu">map_dfr</span><span class="op">(</span><span class="va">interventions</span>, <span class="va">find_cumsum</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  intervention_type cumulative_sum
1          baseline    53478985.93
2   vaccinate 0.001    44803253.91
3    vaccinate 0.01       34550.48</code></pre>
</div>
<div id="herd-immunity-threshold" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="herd-immunity-threshold" class="callout-inner">
<h3 class="callout-title">Herd immunity threshold</h3>
<div class="callout-content">
<p>There exists a target threshold of vaccination based on the basic
reproduction number <span class="math inline">\(R_0\)</span> to achieve
<a href="reference.html#herdimmunity">herd immunity</a>.</p>
<p>The proportion of the population (<span class="math inline">\(p\)</span>) that needs to be immune to achieve
herd immunity is:</p>
<p><span class="math display">\[p = 1- \frac{1}{R_0}. \]</span></p>
<p>This formula is derived from the concept that when a sufficient
proportion of the population is immune, each infected person will
transmit the infection to fewer than one other person on average,
leading to a decline in cases. For details of the mathematical
derivation check out this <a href="https://plus.maths.org/content/maths-minute-r0-and-herd-immunity" class="external-link">Plus
Magazine article</a>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="targeted-vaccination">Targeted vaccination<a class="anchor" aria-label="anchor" href="#targeted-vaccination"></a>
</h2>
<hr class="half-width">
<p>For infections that have a higher burden in different risk groups,
targeted vaccination programs can be utilised to control infection. For
example, if there is heterogeneity in contacts by age, targeting
different age groups for vaccination will result in different disease
trajectories.</p>
<p>We will use the same contact matrix as above from <a href="modelling-interventions.html">Modelling interventions</a>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_matrix</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                 age.group
contact.age.group    [0,15)  [15,65)       65+
          [0,15)  6.8461538 1.655174 0.5892799
          [15,65) 6.0737213 9.169207 4.1223575
          65+     0.5258855 1.002545 1.7142857</code></pre>
</div>
<p>There is higher levels of mixing within the 0-15 and 15-65 age groups
than in the 65+ age group, so we expect that targeting different age
groups will result in different disease trajectories.</p>
<p>To show the effect of targeted vaccination, we will compare the
following scenarios:</p>
<ul>
<li>vaccinating all age groups at a rate 0.001,</li>
<li>vaccinating ages 0-15 only (group 1) at a rate 0.003,</li>
<li>vaccinating ages 15-65 only (group 2) at a rate 0.003,</li>
<li>vaccinating ages 65+ only (group 3) at a rate 0.003.</li>
</ul>
<div class="tabs">
<nav><div id="nav-tab-3" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-3-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-3-1" type="button" role="tab" aria-controls="nav-tabpanel-3-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-3-1">
  Output
  </h3>
</button>
<button class="nav-link" id="nav-tab-3-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-3-2" type="button" role="tab" aria-controls="nav-tabpanel-3-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-3-2">
  R Code
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-3" class="tab-content">
<div id="nav-tabpanel-3-1" class="tab-pane show active" role="tabpanel" aria-labelledby="nav-tab-3-1">
<figure><img src="fig/vaccine-comparisons-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-3-2" class="tab-pane" role="tabpanel" aria-labelledby="nav-tab-3-2">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vaccinate_group_1</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">vaccination</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"vaccinate all"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">40</span>, <span class="fu">nrow</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">40</span> <span class="op">+</span> <span class="fl">150</span>, <span class="fu">nrow</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nu <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">0.001</span> <span class="op">*</span> <span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">vaccinate_group_2</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">vaccination</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"vaccinate all"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">40</span>, <span class="fu">nrow</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">40</span> <span class="op">+</span> <span class="fl">150</span>, <span class="fu">nrow</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nu <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.001</span> <span class="op">*</span> <span class="fl">3</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">vaccinate_group_3</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">vaccination</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"vaccinate all"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">40</span>, <span class="fu">nrow</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">40</span> <span class="op">+</span> <span class="fl">150</span>, <span class="fu">nrow</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nu <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.001</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_vaccinate_group_1</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_default</span><span class="op">(</span></span>
<span>  <span class="co"># population</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  <span class="co"># rate</span></span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  <span class="co"># intervention</span></span>
<span>  vaccination <span class="op">=</span> <span class="va">vaccinate_group_1</span>,</span>
<span>  <span class="co"># time</span></span>
<span>  time_end <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_vaccinate_group_2</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_default</span><span class="op">(</span></span>
<span>  <span class="co"># population</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  <span class="co"># rate</span></span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  <span class="co"># intervention</span></span>
<span>  vaccination <span class="op">=</span> <span class="va">vaccinate_group_2</span>,</span>
<span>  <span class="co"># time</span></span>
<span>  time_end <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">output_vaccinate_group_3</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_default</span><span class="op">(</span></span>
<span>  <span class="co"># population</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  <span class="co"># rate</span></span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  <span class="co"># intervention</span></span>
<span>  vaccination <span class="op">=</span> <span class="va">vaccinate_group_3</span>,</span>
<span>  <span class="co"># time</span></span>
<span>  time_end <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">vaccinate_group_1_infections</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">new_infections</span><span class="op">(</span></span>
<span>  <span class="va">output_vaccinate_group_1</span>,</span>
<span>  compartments_from_susceptible <span class="op">=</span> <span class="st">"vaccinated"</span>,</span>
<span>  by_group <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">vaccinate_group_2_infections</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">new_infections</span><span class="op">(</span></span>
<span>  <span class="va">output_vaccinate_group_2</span>,</span>
<span>  compartments_from_susceptible <span class="op">=</span> <span class="st">"vaccinated"</span>,</span>
<span>  by_group <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">vaccinate_group_3_infections</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">new_infections</span><span class="op">(</span></span>
<span>  <span class="va">output_vaccinate_group_3</span>,</span>
<span>  compartments_from_susceptible <span class="op">=</span> <span class="st">"vaccinated"</span>,</span>
<span>  by_group <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">vaccinate_group_1_infections</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"vaccinate group 1"</span></span>
<span><span class="va">vaccinate_group_2_infections</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"vaccinate group 2"</span></span>
<span><span class="va">vaccinate_group_3_infections</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"vaccinate group 3"</span></span>
<span></span>
<span><span class="va">output_infections</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span></span>
<span>  <span class="va">baseline_infections</span>,</span>
<span>  <span class="va">vaccinate_01_infections</span>,</span>
<span>  <span class="va">vaccinate_group_1_infections</span>,</span>
<span>  <span class="va">vaccinate_group_2_infections</span>,</span>
<span>  <span class="va">vaccinate_group_3_infections</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">output_infections</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span></span>
<span>      <span class="va">time</span>,</span>
<span>      <span class="va">new_infections</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">intervention_type</span>,</span>
<span>      linetype <span class="op">=</span> <span class="va">intervention_type</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>      <span class="va">vaccinate_01</span><span class="op">$</span><span class="va">time_begin</span>,</span>
<span>      <span class="va">vaccinate_01</span><span class="op">$</span><span class="va">time_end</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>Vaccinating group 3 only results in the highest epidemic peak size.
Targeting group 2 results in the smallest epidemic peak size. Whereas
targeting all age groups pushes the epidemic peak time later. As before,
let’s compare the cumulative number of infections under the different
interventions:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interventions_targetted</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu">lst</span><span class="op">(</span></span>
<span>  <span class="va">baseline_infections</span>,</span>
<span>  <span class="va">vaccinate_01_infections</span>,</span>
<span>  <span class="va">vaccinate_group_1_infections</span>,</span>
<span>  <span class="va">vaccinate_group_2_infections</span>,</span>
<span>  <span class="va">vaccinate_group_3_infections</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># apply function to each data frame in the list</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu">map_dfr</span><span class="op">(</span><span class="va">interventions_targetted</span>, <span class="va">find_cumsum</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  intervention_type cumulative_sum
1          baseline       53478986
2   vaccinate 0.001       44803254
3 vaccinate group 1       50429226
4 vaccinate group 2       42035053
5 vaccinate group 3       51634221</code></pre>
</div>
<div class="section level3">
<h3 id="age-specific-infection-fatality-risk">Age-specific infection-fatality-risk<a class="anchor" aria-label="anchor" href="#age-specific-infection-fatality-risk"></a>
</h3>
<p>Targeting specific age groups can reduce the number of deaths in the
eldest age group. To illustrate this, we can define an age-specific
infection-fatality-risk (IFR):</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ifr</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0.00001</span>, <span class="fl">0.001</span>, <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">ifr</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">rownames</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span></span></code></pre>
</div>
<p>To convert infections to deaths, we will need new infections by age
group, so we call <code>new_infections()</code> with
<code>by_group = TRUE</code> and then multiply the new infections by the
IFR for that age group:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vaccinate_group_1_age</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">new_infections</span><span class="op">(</span></span>
<span>  <span class="va">output_vaccinate_group_1</span>,</span>
<span>  compartments_from_susceptible <span class="op">=</span> <span class="st">"vaccinated"</span>,</span>
<span>  by_group <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">vaccinate_group_1_deaths</span> <span class="op">&lt;-</span></span>
<span>  <span class="fl">1</span><span class="op">:</span><span class="fl">3</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">map_dfr</span><span class="op">(</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="va">vaccinate_group_1_age</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">filter</span><span class="op">(</span><span class="va">demography_group</span> <span class="op">==</span> <span class="fu">names</span><span class="op">(</span><span class="va">ifr</span><span class="op">)</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">mutate</span><span class="op">(</span>deaths <span class="op">=</span> <span class="va">new_infections</span> <span class="op">*</span> <span class="va">ifr</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<p>Vaccinating all age groups has the greatest impact on deaths in the
eldest age group (over 65 years of age), but we also see that
vaccinating group 2 reduces the deaths in the eldest age group.
Targeting younger groups can the number of deaths in the eldest age
group (over 65 years of age).</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">baseline_deaths</span><span class="op">$</span><span class="va">intervention_type</span>  <span class="op">&lt;-</span> <span class="st">"baseline"</span></span>
<span><span class="va">vaccinate_01_deaths</span><span class="op">$</span><span class="va">intervention_type</span>  <span class="op">&lt;-</span> <span class="st">"vaccinate 0.001"</span></span>
<span><span class="va">vaccinate_group_1_deaths</span><span class="op">$</span><span class="va">intervention_type</span>  <span class="op">&lt;-</span> <span class="st">"vaccinate group 1"</span></span>
<span><span class="va">vaccinate_group_2_deaths</span><span class="op">$</span><span class="va">intervention_type</span>  <span class="op">&lt;-</span> <span class="st">"vaccinate group 2"</span></span>
<span><span class="va">vaccinate_group_3_deaths</span><span class="op">$</span><span class="va">intervention_type</span>  <span class="op">&lt;-</span> <span class="st">"vaccinate group 3"</span></span>
<span></span>
<span><span class="va">output_deaths</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">baseline_deaths</span>,</span>
<span>                       <span class="va">vaccinate_01_deaths</span>,</span>
<span>                       <span class="va">vaccinate_group_1_deaths</span>,</span>
<span>                       <span class="va">vaccinate_group_2_deaths</span>,</span>
<span>                       <span class="va">vaccinate_group_3_deaths</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_deaths</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">demography_group</span> <span class="op">==</span> <span class="st">"65+"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Deaths"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>            <span class="fu">aes</span><span class="op">(</span><span class="va">time</span>,</span>
<span>              <span class="va">deaths</span>,</span>
<span>              colour <span class="op">=</span> <span class="va">intervention_type</span>,</span>
<span>              linetype <span class="op">=</span> <span class="va">demography_group</span></span>
<span>            <span class="op">)</span>,</span>
<span>            linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/vaccine-comparisons-rendered-unnamed-chunk-17-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</section><section><h2 class="section-heading" id="vaccination-versus-npis">Vaccination versus NPIs<a class="anchor" aria-label="anchor" href="#vaccination-versus-npis"></a>
</h2>
<hr class="half-width">
<p>Modelling is a useful tool for understanding the potential impact of
the timing and different combinations of control measures. In an
outbreak scenario, vaccines can be used alongside other control
measures. A recent study by <a href="https://doi.org/10.1016/S2214-109X(24)00286-9" class="external-link">Barnsley et
al. (2024)</a> used modelling to show the impact the COVID-19 vaccine
could have had alongside NPIs if the vaccine had been developed within
100 days of the pathogen threat being recognised. We will use this study
as inspiration to show the impact of a vaccine versus NPI implemented at
different times.</p>
<p>The NPI we will consider is temporarily closing schools, an
intervention that has been used as a control measure for seasonal
influenza <a href="https://doi.org/10.3201/eid1410.080646" class="external-link">(Cowling et
al. 2008)</a>. Specifically, we will model a school closure that will
reduce the contacts between school aged children (aged 0-15) by 0.5, and
will cause a small reduction (0.01) in the contacts between adults (aged
15 and over). For the vaccine program, we assume an equal vaccination
rate of 0.01 in each age group.</p>
<p>We define <strong>early implementation</strong> as the first day of
the simulation (i.e. when there are less than 100 infections in total),
and <strong>late implementation</strong> as 50 days after the start of
the simulation (i.e. when there are approximately 50,000 infections in
total). We assume the control measures are in place for 100 days after
they start.</p>
<p>The combinations we will consider are :</p>
<ul>
<li>early implementation of closing schools,</li>
<li>early implementation of a vaccine,</li>
<li>late implementation of a vaccine,</li>
<li>early implementation of closing schools and late implementation of a
vaccine.</li>
</ul>
<p>The code below details how the interventions are simulated:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">early_start</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">late_start</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">duration</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">time_end</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span></span>
<span><span class="co"># close schools early</span></span>
<span><span class="va">close_schools_early</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">intervention</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"School closure"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"contacts"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="va">early_start</span>,</span>
<span>  time_end <span class="op">=</span> <span class="va">early_start</span> <span class="op">+</span> <span class="va">duration</span>,</span>
<span>  reduction <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># vaccination late</span></span>
<span><span class="va">vacc_late</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">vaccination</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"vaccinate late"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="va">late_start</span>, <span class="fu">nrow</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="va">late_start</span> <span class="op">+</span> <span class="va">duration</span>, <span class="fu">nrow</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nu <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># npis started early + vaccination late</span></span>
<span><span class="va">output_npi_early_vacc_late</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_default</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  vaccination <span class="op">=</span> <span class="va">vacc_late</span>,</span>
<span>  intervention <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>contacts <span class="op">=</span> <span class="va">close_schools_early</span><span class="op">)</span>,</span>
<span>  time_end <span class="op">=</span> <span class="va">time_end</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Early implementation of NPIs (<code>early npi</code>) delays the
timing of the peak of infectious individuals but does not decrease the
magnitude by much once the measure is lifted. Early implementation of
the vaccine (<code>early vacc</code>) is the most effective control for
reducing the peak number of infectious individuals, because it reduces
the size of the susceptible group rather than just temporarily keeping
infections away from it. Having an NPI in place before the vaccine is
implemented (<code>early npi, late vacc</code>) is more effective than
simply just implementing the vaccine late (<code>late vacc</code>).</p>
<figure><img src="fig/vaccine-comparisons-rendered-unnamed-chunk-20-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="lifting-npi-measures" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="lifting-npi-measures" class="callout-inner">
<h3 class="callout-title">Lifting NPI measures</h3>
<div class="callout-content">
<p>Investigate the impact lifting the after implementing the vaccine.
Adapt the code below to lift the NPI after 20, 50 and 100 days</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Output
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duration_20</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">duration_50</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="va">close_schools_early_20</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">intervention</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"School closure"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"contacts"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="va">early_start</span>,</span>
<span>  time_end <span class="op">=</span> <span class="va">early_start</span> <span class="op">+</span> <span class="va">duration_20</span>,</span>
<span>  reduction <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">close_schools_early_50</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">intervention</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"School closure"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"contacts"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="va">early_start</span>,</span>
<span>  time_end <span class="op">=</span> <span class="va">early_start</span> <span class="op">+</span> <span class="va">duration_50</span>,</span>
<span>  reduction <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_npi_early_vacc_late_20</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_default</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  vaccination <span class="op">=</span> <span class="va">vacc_late</span>,</span>
<span>  intervention <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>contacts <span class="op">=</span> <span class="va">close_schools_early_20</span><span class="op">)</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">300</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_npi_early_vacc_late_50</span> <span class="op">&lt;-</span> <span class="fu">epidemics</span><span class="fu">::</span><span class="fu">model_default</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  vaccination <span class="op">=</span> <span class="va">vacc_late</span>,</span>
<span>  intervention <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>contacts <span class="op">=</span> <span class="va">close_schools_early_50</span><span class="op">)</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">300</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_npi_early_vacc_late_20</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"20 days"</span></span>
<span><span class="va">output_npi_early_vacc_late_50</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"50 days"</span></span>
<span><span class="va">output_npi_early_vacc_late</span><span class="op">$</span><span class="va">intervention_type</span> <span class="op">&lt;-</span> <span class="st">"100 days"</span></span>
<span></span>
<span><span class="va">output_npis</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">output_npi_early_vacc_late_20</span>,</span>
<span>                     <span class="va">output_npi_early_vacc_late_50</span>,</span>
<span>                     <span class="va">output_npi_early_vacc_late</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_npis</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">time</span>,</span>
<span>    y <span class="op">=</span> <span class="va">value</span>,</span>
<span>    color <span class="op">=</span> <span class="va">intervention_type</span>,</span>
<span>    linetype <span class="op">=</span> <span class="va">intervention_type</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>      <span class="va">early_start</span>,</span>
<span>      <span class="va">early_start</span> <span class="op">+</span> <span class="va">duration</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>      <span class="va">late_start</span>,</span>
<span>      <span class="va">late_start</span> <span class="op">+</span> <span class="va">duration</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/vaccine-comparisons-rendered-unnamed-chunk-21-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<p>Using model generated disease trajectories we have investigated the
potential impact of different vaccination strategies. When infection has
group specific risk, targeted vaccination programs may be more effective
in reducing epidemic peak. NPIs can be used alongside vaccine
development to delay epidemic peaks before vaccines are readily
available.</p>
<p>We used a SEIR model with a vaccination class, but if we modelled
immunity to infection then we could investigate the impact of a
vaccination program if it was implemented very late in the epidemic
(i.e. after post-infection immunity had accumulated). See for example,
<a href="https://doi.org/10.1016/j.vaccine.2010.01.002" class="external-link">Baguelin et
al. 2010</a></p>
<p>In this tutorial we have investigated the potential effect of
infection blocking vaccines, but we can use models to explore other
effects of vaccines including imperfect vaccines. The disease
trajectories generated in this tutorial can be used to calculate
measures such as <a href="reference.html#dalys">DALYs</a> averted as
part of health economic analyses.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Herd immunity is a indirect effect of vaccination programs</li>
<li>Targeted vaccination programs have benefits when there is
heterogeneity in contacts</li>
<li>The timing of implementation of vaccination programs and NPIs can
result in very different disease trajectories</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-disease-burden"><p>Content from <a href="disease-burden.html">Modelling disease burden</a></p>
<hr>
<p>Last updated on 2025-05-06 |

        <a href="https://github.com/epiverse-trace/tutorials-late/edit/main/episodes/disease-burden.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can we model disease burden and healthcare demand?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand when mathematical models of transmission can be separated
from models of burden</li>
<li>Generate estimates of disease burden and healthcare demand using a
burden model</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="prereq1" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Prerequisite</h3>
<div class="callout-content">
<ul>
<li>Complete tutorial on <a href="simulating-transmission.html">Simulating transmission</a>
</li>
</ul>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>In previous tutorials we have used mathematical models to generate
trajectories of infections, but we may also be interested in measures of
disease burden. These measures could include:</p>
<ul>
<li>Health outcomes in the population (e.g., mild vs. severe
infections)</li>
<li>Healthcare system impacts (e.g., hospitalizations, ICU
admissions)</li>
<li>Economic impacts (e.g., productivity loss, healthcare costs)</li>
</ul>
<p>In mathematical models, we can track disease burden in different
ways:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Integrated approach</strong>: Include burden compartments
directly in the transmission model (e.g., hospital compartments in ODE
models)</li>
<li>
<strong>Separated approach</strong>: First simulate transmission,
then use the results to estimate burden</li>
</ol>
<p>The choice between these approaches depends on whether burden affects
transmission. For example:</p>
<ul>
<li>For Ebola, hospitalizations are important for transmission due to
high-risk healthcare settings</li>
<li>For many respiratory infections, severe illness typically occurs
after the infectious period, so burden can be modeled separately</li>
</ul>
<p>In this tutorial, we’ll focus on the separated approach, where we
first run an epidemic model to simulate infections, then use these
values to estimate disease burden as a follow-on analysis. We’ll use
<code>{epidemics}</code> to simulate disease trajectories,
<a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a> for social contact data, and
<a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a> for data manipulation and plotting.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">epiparameter</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">epidemics</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">socialmixr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>

</section><section><h2 class="section-heading" id="a-burden-model">A burden model<a class="anchor" aria-label="anchor" href="#a-burden-model"></a>
</h2>
<hr class="half-width">
<p>We will extend the influenza example from the <a href="simulating-transmission.html">Simulating transmission</a> tutorial
to calculate hospitalizations over time. Our approach has two main
components:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Transmission model</strong>: An SEIR model that generates
new infections over time</li>
<li>
<strong>Burden model</strong>: Converts new infections to
hospitalizations by accounting for delays between infection and
hospitalization</li>
</ol>
<p>To convert infections to hospitalizations, we need to consider:</p>
<ul>
<li>The probability that an infection leads to hospitalization
(infection-hospitalization ratio, IHR)</li>
<li>The time delay from infection to hospital admission</li>
<li>The time spent in hospital before discharge</li>
</ul>
<p>We’ll use <a href="https://github.com/epiverse-trace/epiparameter/" class="external-link">epiparameter</a> to define these delay
distributions. The Gamma distribution is commonly used for these delays
because:</p>
<ul>
<li>It’s flexible and can model various shapes</li>
<li>It’s bounded at zero (negative delays don’t make sense)</li>
<li>It’s supported by empirical data for many infectious diseases</li>
</ul>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_cases</span> <span class="op">&lt;-</span> <span class="fu">new_infections</span><span class="op">(</span><span class="va">output_plot</span>, by_group <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">new_cases</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Key: &lt;time&gt;
    time new_infections
   &lt;num&gt;          &lt;num&gt;
1:     0       0.000000
2:     1       3.467732
3:     2       3.205905
4:     3       3.110635
5:     4       3.116127
6:     5       3.183494</code></pre>
</div>
<p>To convert the new infections to hospitalisations we need to
parameter distributions to describe the following processes :</p>
<ul>
<li><p>the time from infection to admission to hospital,</p></li>
<li><p>the time from admission to discharge from hospital.</p></li>
</ul>
<p>We will use the function <code>epiparameter()</code> from
<a href="https://github.com/epiverse-trace/epiparameter/" class="external-link">epiparameter</a> package to define and store parameter
distributions for these processes.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define delay parameters</span></span>
<span><span class="va">infection_to_admission</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"COVID-19"</span>,</span>
<span>  epi_name <span class="op">=</span> <span class="st">"infection to admission"</span>,</span>
<span>  prob_distribution <span class="op">=</span> <span class="fu">create_prob_distribution</span><span class="op">(</span></span>
<span>    prob_distribution <span class="op">=</span> <span class="st">"gamma"</span>,</span>
<span>    prob_distribution_params <span class="op">=</span> <span class="fu">c</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">5</span>, scale <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    discretise <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The shape and scale parameters were chosen based on data from COVID-19 studies</span></span>
<span><span class="co"># showing a median time from infection to hospitalization of around 10 days</span></span>
<span><span class="co"># with right-skewed distribution reflecting variability in disease progression</span></span></code></pre>
</div>
<p>To visualise this distribution we can create a density plot :</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_range</span> <span class="op">&lt;-</span> <span class="fu">seq</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">60</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">density_df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>days <span class="op">=</span> <span class="va">x_range</span>,</span>
<span>                         density_admission <span class="op">=</span> <span class="fu">density</span><span class="op">(</span><span class="va">infection_to_admission</span>,</span>
<span>                                                     <span class="va">x_range</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">density_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">days</span>, y <span class="op">=</span> <span class="va">density_admission</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"infection to admission (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"pdf"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/disease-burden-rendered-unnamed-chunk-5-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="define-distribution-for-admission-to-discharge" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="define-distribution-for-admission-to-discharge" class="callout-inner">
<h3 class="callout-title">Define distribution for admission to discharge</h3>
<div class="callout-content">
<p>Using the function <code>epiparameter()</code> define the
distribution for admission to discharge as a Gamma distribution with
shape = 10 and scale = 2 and plot the density of this distribution.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">admission_to_discharge</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"COVID-19"</span>,</span>
<span>  epi_name <span class="op">=</span> <span class="st">"admission to discharge"</span>,</span>
<span>  prob_distribution <span class="op">=</span> <span class="fu">create_prob_distribution</span><span class="op">(</span></span>
<span>    prob_distribution <span class="op">=</span> <span class="st">"gamma"</span>,</span>
<span>    prob_distribution_params <span class="op">=</span> <span class="fu">c</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">10</span>, scale <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    discretise <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">x_range</span> <span class="op">&lt;-</span> <span class="fu">seq</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">60</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">density_df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>days <span class="op">=</span> <span class="va">x_range</span>,</span>
<span>                         density_discharge <span class="op">=</span> <span class="fu">density</span><span class="op">(</span><span class="va">admission_to_discharge</span>,</span>
<span>                                                     <span class="va">x_range</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">density_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">days</span>, y <span class="op">=</span> <span class="va">density_discharge</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"admission to discharge (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"pdf"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/disease-burden-rendered-unnamed-chunk-6-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>To convert the new infections to number in hospital over time we will
do the following:</p>
<ol style="list-style-type: decimal">
<li>Calculate the expected numbers of new infections that will be
hospitalised using the infection hospitalisation ratio (IHR)</li>
<li>Calculate the estimated number of new hospitalisations at each point
in time using the infection to admission distribution</li>
<li>Calculate the estimated number of discharge at each point in time
using the admission to discharge distribution</li>
<li>Calculate the number in hospital at each point in time as the
difference between the cumulative sum of hospital admissions and the
cumulative sum of discharges so far.</li>
</ol>
<div class="section level4">
<h4 id="calculate-the-expected-numbers-of-new-hospitalisations-using-the-infection-hospitalisation-ratio-ihr">1. Calculate the expected numbers of new hospitalisations using the
infection hospitalisation ratio (IHR)<a class="anchor" aria-label="anchor" href="#calculate-the-expected-numbers-of-new-hospitalisations-using-the-infection-hospitalisation-ratio-ihr"></a>
</h4>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ihr</span> <span class="op">&lt;-</span> <span class="fl">0.1</span> <span class="co"># infection-hospitalisation ratio</span></span>
<span><span class="co"># This value is based on estimates from early COVID-19 data</span></span>
<span><span class="co"># and represents the proportion of infections that require hospitalization</span></span>
<span></span>
<span><span class="co"># calculate expected numbers with convolution:</span></span>
<span><span class="va">hosp</span> <span class="op">&lt;-</span> <span class="va">new_cases</span><span class="op">$</span><span class="va">new_infections</span> <span class="op">*</span> <span class="va">ihr</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="calculate-the-estimated-number-of-new-hospitalisations-using-the-infection-to-admission-distribution">2. Calculate the estimated number of new hospitalisations using the
infection to admission distribution<a class="anchor" aria-label="anchor" href="#calculate-the-estimated-number-of-new-hospitalisations-using-the-infection-to-admission-distribution"></a>
</h4>
<p>To estimate the number of new hospitalisations we use a method called
convolution.</p>
<div id="what-is-convolution" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="what-is-convolution" class="callout-inner">
<h3 class="callout-title">What is convolution?</h3>
<div class="callout-content">
<p>If we want to know how people are admitted to hospital on day <span class="math inline">\(t\)</span>, then we need to add up the number of
people admitted on day <span class="math inline">\(t\)</span> but
infected on day <span class="math inline">\(t-1\)</span>, day <span class="math inline">\(t-2\)</span>, day <span class="math inline">\(t-3\)</span> etc. We therefore need to sum over
the distribution of delays from infection to admission. If <span class="math inline">\(f_j\)</span> is the probability an infected
individual who will be hospitalised will be admitted to hospital <span class="math inline">\(j\)</span> days later, and <span class="math inline">\(I_{t-j}\)</span> is the number of individuals
infected on day <span class="math inline">\(t-j\)</span>, then the total
admissions on day <span class="math inline">\(t\)</span> is equal to
<span class="math inline">\(\sum_j I_{t-j} f_j\)</span>. This type of
rolling calculation is known as a convolution (see this <a href="https://mathworld.wolfram.com/Convolution.html" class="external-link">Wolfram
article</a> for some mathematical detail). There are different methods
to calculate convolutions, but we will use the built in R function
<code>convolve()</code>to perform the summation efficiently from the
number of infections and the delay distribution.</p>
</div>
</div>
</div>
<p>The function <code>convolve()</code> requires inputs of two vectors
which will be convolved and <code>type</code>. Here we will specify
<code>type = "open"</code>, this fills the vectors with 0s to ensure
they are the same length.</p>
<p>The inputs to be convolved are the expected number of infections that
will end up hospitalised (<code>hosp</code>) and the density values of
the distribution of infection to admission times. We will calculate the
density for the minimum possible value (0 days) up to the tail of the
distribution (here defined as the 99.9th quantile, i.e. it is very
unlikely any cases will be hospitalised after a delay this long).</p>
<p>Convolution requires one of the inputs to be reversed, in our case we
will reverse the density distribution of infection to admission times.
This is because if people infected earlier in time get admitted today,
it means they’ve had a longer delay from infection to admission than
someone infected more recently. In effect the infection to admission
delay tells us how far we have to ‘rewind’ time to find previously new
infections that are now showing up as hospital admissions.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define tail of the delay distribution</span></span>
<span><span class="va">tail_value_admission</span> <span class="op">&lt;-</span> <span class="fu">quantile</span><span class="op">(</span><span class="va">infection_to_admission</span>, <span class="fl">0.999</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hospitalisations</span> <span class="op">&lt;-</span> <span class="fu">convolve</span><span class="op">(</span><span class="va">hosp</span>,</span>
<span>                             <span class="fu">rev</span><span class="op">(</span><span class="fu">density</span><span class="op">(</span><span class="va">infection_to_admission</span>,</span>
<span>                                         <span class="fl">0</span><span class="op">:</span><span class="va">tail_value_admission</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                             type <span class="op">=</span> <span class="st">"open"</span><span class="op">)</span><span class="op">[</span><span class="fu">seq_along</span><span class="op">(</span><span class="va">hosp</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="calculate-the-estimated-number-of-discharges">3. Calculate the estimated number of discharges<a class="anchor" aria-label="anchor" href="#calculate-the-estimated-number-of-discharges"></a>
</h4>
<p>Using the same approach as above, we convolve the hospitalisations
with the distribution of admission to discharge times to obtain the
estimated number of new discharges.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tail_value_discharge</span> <span class="op">&lt;-</span> <span class="fu">quantile</span><span class="op">(</span><span class="va">admission_to_discharge</span>, <span class="fl">0.999</span><span class="op">)</span></span>
<span><span class="va">discharges</span> <span class="op">&lt;-</span> <span class="fu">convolve</span><span class="op">(</span><span class="va">hospitalisations</span>, <span class="fu">rev</span><span class="op">(</span><span class="fu">density</span><span class="op">(</span><span class="va">admission_to_discharge</span>,</span>
<span>                                                     <span class="fl">0</span><span class="op">:</span><span class="va">tail_value_discharge</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       type <span class="op">=</span> <span class="st">"open"</span><span class="op">)</span><span class="op">[</span><span class="fu">seq_along</span><span class="op">(</span><span class="va">hospitalisations</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="calculate-the-number-in-hospital-as-the-difference-between-the-cumulative-sum-of-hospitalisations-and-the-cumulative-sum-of-discharges">4. Calculate the number in hospital as the difference between the
cumulative sum of hospitalisations and the cumulative sum of
discharges<a class="anchor" aria-label="anchor" href="#calculate-the-number-in-hospital-as-the-difference-between-the-cumulative-sum-of-hospitalisations-and-the-cumulative-sum-of-discharges"></a>
</h4>
<p>We can use the R function <code>cumsum()</code> to calculate the
cumulative number of hospitalisations and discharges. The difference
between these two quantities gives us the current number of people in
hospital at each time point.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate the current number in hospital</span></span>
<span><span class="va">in_hospital</span> <span class="op">&lt;-</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">hospitalisations</span><span class="op">)</span> <span class="op">-</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">discharges</span><span class="op">)</span></span></code></pre>
</div>
<p>We create a data frame to plot our outcomes using
<code>pivot_longer()</code>:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create data frame</span></span>
<span><span class="va">hosp_df</span> <span class="op">&lt;-</span> <span class="fu">cbind</span><span class="op">(</span><span class="va">new_cases</span>, in_hospital <span class="op">=</span> <span class="va">in_hospital</span>,</span>
<span>                 hospitalisations <span class="op">=</span> <span class="va">hospitalisations</span><span class="op">)</span></span>
<span><span class="co"># pivot longer for plotting</span></span>
<span><span class="va">hosp_df_long</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">hosp_df</span>, cols <span class="op">=</span> <span class="va">new_infections</span><span class="op">:</span><span class="va">hospitalisations</span>,</span>
<span>                             names_to <span class="op">=</span> <span class="st">"outcome"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">hosp_df_long</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">time</span>,</span>
<span>      y <span class="op">=</span> <span class="va">value</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">outcome</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Time (days)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/disease-burden-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<p>In this tutorial, we learned how to estimate hospitalizations based
on daily new infections from a transmission model. This approach can be
extended to other measures of disease burden, such as:</p>
<ul>
<li>ICU admissions</li>
<li>Deaths</li>
<li>Disability-Adjusted Life-Years (DALYs)</li>
<li>Healthcare costs</li>
</ul>
<p>These burden estimates are valuable for:</p>
<ul>
<li>Healthcare system planning</li>
<li>Health economic analyses</li>
<li>Policy decision-making</li>
</ul>
<p>As a follow-up, you might be interested in <a href="https://epiverse-trace.github.io/howto/analyses/reconstruct_transmission/estimate_infections.html" class="external-link">this
how-to guide</a>, which shows how to estimate original infection events
from reported hospitalizations or deaths over time.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Transmission models should include disease burden when it affects
onward transmission</li>
<li>Outputs of transmission models can be used as inputs to models of
burden</li>
<li>The Gamma distribution is commonly used to model delays in disease
progression</li>
<li>Convolution is a powerful tool for estimating disease burden from
transmission model outputs</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/epiverse-trace/tutorials-late/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/epiverse-trace/tutorials-late/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/epiverse-trace/tutorials-late/" class="external-link">Source</a></p>
				<p><a href="https://github.com/epiverse-trace/tutorials-late/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:andree.valle-campos@lshtm.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/epiverse-trace/sandpaper/tree/patch-renv-github-bug" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/5e0d711121a581777d83cf270e298c933f112d52" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/epiverse-trace/varnish/tree/epiversetheme" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://epiverse-trace.github.io/tutorials-late/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "epidemic models, interventions",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://epiverse-trace.github.io/tutorials-late/aio.html",
  "identifier": "https://epiverse-trace.github.io/tutorials-late/aio.html",
  "dateCreated": "2025-05-13",
  "dateModified": "2025-05-20",
  "datePublished": "2025-05-20"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

